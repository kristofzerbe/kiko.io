{"type":"getPostById","data":{"title":"Hexo and the Dark Mode ... revised","date":"2019-10-26T12:08:05.000Z","description":"<p>While writing my post <a href=\"/categories/Tools/Hexo-and-the-Dark-Mode\">Hexo and the Dark Mode</a> a few days ago, I thought it would be nice, if I could switch between the normal (light) and the dark theme, I’ve created for the support of the OS-related Dark Mode, even manually. The only thing I needed was a toggle element and a little bit of JavaScript.</p>\n<p>Of course, I couldn’t manipulate the <a href=\"https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-color-scheme\">media query <code>prefers-color-scheme</code></a> itself, but introduce a different way by blog uses it. Instead of implementing the media query directly into my CSS (or Stylus) code, I used a root selector, which can be manipulated by JavaScript … something like this:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: white;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: black;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":[{"name":"Tools","_id":"cllzod0d7003bmkoqgi75g1j4"}],"tags":[{"name":"Hexo","_id":"cllzod0d50038mkoq9ubeg20l"},{"name":"CSS","_id":"cllzod0d7003cmkoq4ljub268"},{"name":"Stylus","_id":"cllzod0dq004fmkoqgppl5kk2"},{"name":"Dark Mode","_id":"cllzod0dr004hmkoq3yxp3i6m"}],"content":"<p>While writing my post <a href=\"/categories/Tools/Hexo-and-the-Dark-Mode\">Hexo and the Dark Mode</a> a few days ago, I thought it would be nice, if I could switch between the normal (light) and the dark theme, I’ve created for the support of the OS-related Dark Mode, even manually. The only thing I needed was a toggle element and a little bit of JavaScript.</p>\n<p>Of course, I couldn’t manipulate the <a href=\"https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-color-scheme\">media query <code>prefers-color-scheme</code></a> itself, but introduce a different way by blog uses it. Instead of implementing the media query directly into my CSS (or Stylus) code, I used a root selector, which can be manipulated by JavaScript … something like this:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: white;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: black;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>In every Stylus file, where I used <code>@media prefers-dark</code> to achieve the automatic switch by the OS, I changed this line into <code>/[data-theme=&quot;dark&quot;] &amp;</code> :</p>\n<figure class=\"highlight styl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#mobile-nav-header</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: color-background</span><br><span class=\"line\">  /<span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> &amp;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-color-background</span><br><span class=\"line\">  <span class=\"selector-tag\">img</span><span class=\"selector-class\">.avatar</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    /<span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> &amp;</span><br><span class=\"line\">      <span class=\"attribute\">filter</span>: <span class=\"built_in\">brightness</span>(<span class=\"number\">85%</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Some explanations on the <a href=\"http://stylus-lang.com/docs/selectors.html\">Stylus syntax</a>: <code>/</code> means the root of the DOM and <code>&amp;</code> points to the parent selector. Therefore the example will be rendered into this:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#mobile-nav-header</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> <span class=\"selector-id\">#mobile-nav-header</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#111</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#mobile-nav-header</span> <span class=\"selector-tag\">img</span><span class=\"selector-class\">.avatar</span> &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> <span class=\"selector-id\">#mobile-nav-header</span> <span class=\"selector-tag\">img</span><span class=\"selector-class\">.avatar</span></span><br><span class=\"line\">    <span class=\"attribute\">filter</span>: <span class=\"built_in\">brightness</span>(<span class=\"number\">85%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Only problem was: the “Root + Parent” Stylus selector doesn’t work in the block variables in the <code>_extend.styl</code>. So I had to copy all theme relevant styles directly to the elements, where such a block was used: <code>@extend &lt;block-name&gt;</code>.</p>\n<h2 id=\"The-Toggle-Switch\"><a href=\"#The-Toggle-Switch\" class=\"headerlink\" title=\"The Toggle Switch\"></a>The Toggle Switch</h2><p>In the <code>footer.ejs</code> I added a toggle checkbox, where I could bind my JavaScript…</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;footer-theme&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;theme-switch&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;theme-switch&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>… and some CSS in the <code>footer.styl</code>, to style it:</p>\n<figure class=\"highlight styl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input<span class=\"selector-id\">#theme-switch</span><span class=\"selector-attr\">[type=checkbox]</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">input<span class=\"selector-id\">#theme-switch</span><span class=\"selector-attr\">[type=checkbox]</span> + <span class=\"selector-tag\">label</span></span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">16px</span></span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">16px</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">12px</span></span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">22px</span></span><br><span class=\"line\">  <span class=\"attribute\">cursor</span>: pointer</span><br><span class=\"line\">  <span class=\"selector-pseudo\">&amp;:before</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: inherit</span><br><span class=\"line\">    <span class=\"attribute\">text-rendering</span>: auto</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">font-smoothing</span>: antialiased</span><br><span class=\"line\">    <span class=\"attribute\">font-family</span>: fa-icon-solid</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: icon-moon</span><br><span class=\"line\"></span><br><span class=\"line\">input<span class=\"selector-id\">#theme-switch</span><span class=\"selector-attr\">[type=checkbox]</span><span class=\"selector-pseudo\">:checked</span> + <span class=\"selector-tag\">label</span></span><br><span class=\"line\">  <span class=\"selector-pseudo\">&amp;:before</span></span><br><span class=\"line\">    <span class=\"attribute\">content</span>: icon-sun</span><br></pre></td></tr></table></figure>\n\n<p>The <code>icon</code> variables are defined in the <code>_variables.styl</code> like this:</p>\n<figure class=\"highlight styl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">icon</span>-moon = <span class=\"string\">&quot;\\f186&quot;</span></span><br><span class=\"line\"><span class=\"attribute\">icon</span>-sun = <span class=\"string\">&quot;\\f185&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"The-JavaScript\"><a href=\"#The-JavaScript\" class=\"headerlink\" title=\"The JavaScript\"></a>The JavaScript</h2><p>Everything was now prepared to implement the switching code in JavaScript, which should support a manual switch by clicking the toggle element as well as the automatic switch by the OS.</p>\n<p>I wrapped all necessary code into a seperate JS file and placed a reference in the <code>after-footer.ejs</code>, which places it at the bottom of the HTML:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- js(&#x27;js/dark-mode-toggle.js&#x27;) %&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">detectColorScheme</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> theme = <span class=\"string\">&quot;light&quot;</span>; <span class=\"comment\">//default</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get last used theme from local cache</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;theme&quot;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;theme&quot;</span>) === <span class=\"string\">&quot;dark&quot;</span>)&#123;</span><br><span class=\"line\">            theme = <span class=\"string\">&quot;dark&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(!<span class=\"variable language_\">window</span>.<span class=\"property\">matchMedia</span>) &#123; </span><br><span class=\"line\">        <span class=\"comment\">// matchMedia not supported  </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&quot;(prefers-color-scheme: dark)&quot;</span>).<span class=\"property\">matches</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// OS has set Dark Mode</span></span><br><span class=\"line\">        theme = <span class=\"string\">&quot;dark&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// set detected theme</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (theme === <span class=\"string\">&quot;dark&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeDark</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeLight</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> toggleTheme = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;input#theme-switch[type=&quot;checkbox&quot;]&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setThemeDark</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;theme&#x27;</span>, <span class=\"string\">&#x27;dark&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;data-theme&#x27;</span>, <span class=\"string\">&#x27;dark&#x27;</span>);</span><br><span class=\"line\">    toggleTheme.<span class=\"property\">checked</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setThemeLight</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;theme&#x27;</span>, <span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;data-theme&#x27;</span>, <span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">    toggleTheme.<span class=\"property\">checked</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Listener for theme change by toggle</span></span><br><span class=\"line\">toggleTheme.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;change&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">target</span>.<span class=\"property\">checked</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeDark</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeLight</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Listener for theme change by OS</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> toggleOS = <span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>);</span><br><span class=\"line\">toggleOS.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;change&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">matches</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeDark</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">setThemeLight</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// call theme detection</span></span><br><span class=\"line\"><span class=\"title function_\">detectColorScheme</span>();</span><br></pre></td></tr></table></figure>\n\n<p>By using the both <code>addEventListener</code>‘s, each switch will be recognized and this approach is capable to support even more themes, just by using different values in the <code>data-theme</code> attribute.</p>\n","_path":"post/Hexo-and-the-Dark-Mode-revised/","_link":"https://kiko.io/post/Hexo-and-the-Dark-Mode-revised/","_id":"cllzod09t000dmkoqaoqubbnk"}}