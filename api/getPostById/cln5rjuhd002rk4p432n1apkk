{"type":"getPostById","data":{"title":"Simplest Console File Logger","date":"2022-06-19T11:31:25.000Z","description":"<p>When you need to do a task in IT and don’t need a fancy user interface, you usually turn to a console application or develop one. But no UI means not, that you don’t want to get some information about the status of the running program. The means of choice in C#&#x2F;.NET is then the output of certain values in the console via <code>console.WriteLine()</code>.</p>\n<p>But often these applications are supposed to run in the background or hidden, so that crashes or errors are not immediately noticeable if you don’t have at least a rudimentary logging built in. Such logging is also useful for the later evaluation of program runs. For this reason pretty much all programs log in some way. Currently there an incredible number of logging frameworks available, that make it to the news every now and then, like <a href=\"https://en.wikipedia.org/wiki/Log4Shell\">Log4Shell</a> for Java.</p>\n<p>The best known in the .NET area is Microsoft’s own <a href=\"https://docs.microsoft.com/en-us/dotnet/core/extensions/logging\">ILogger (Microsoft.Extensions.Logging)</a>, <a href=\"https://logging.apache.org/log4net/\">log4net</a>, <a href=\"https://nlog-project.org/\">NLog</a> and <a href=\"https://serilog.net/\">Serilog</a>. What they all have in common is, that they are highly flexible in terms of configuration, usage and storage of the logs. On the other hand, they are fat beasts, you have to learn to handle first and you have to deliver with the program always. The latter does not apply to the ILogger, but Microsoft has been known to complicate things so unnecessarily that it is almost no fun anymore.</p>\n<p>Many times this overload is simply not necessary, when you just need a log file for each run of your console application. Let me show you, how to achieve this with a dead simple <code>StringBuilder</code>…</p>","categories":[{"name":".NET","_id":"cln5rjuj60054k4p4cner3pp2"}],"tags":[{"name":"Visual Studio","_id":"cln5rjuj60053k4p4gbnx3oaj"},{"name":"Logging","_id":"cln5rjum900cxk4p42oc27sal"},{"name":"C#","_id":"cln5rjuma00cyk4p4hz4y76nk"}],"content":"<p>When you need to do a task in IT and don’t need a fancy user interface, you usually turn to a console application or develop one. But no UI means not, that you don’t want to get some information about the status of the running program. The means of choice in C#&#x2F;.NET is then the output of certain values in the console via <code>console.WriteLine()</code>.</p>\n<p>But often these applications are supposed to run in the background or hidden, so that crashes or errors are not immediately noticeable if you don’t have at least a rudimentary logging built in. Such logging is also useful for the later evaluation of program runs. For this reason pretty much all programs log in some way. Currently there an incredible number of logging frameworks available, that make it to the news every now and then, like <a href=\"https://en.wikipedia.org/wiki/Log4Shell\">Log4Shell</a> for Java.</p>\n<p>The best known in the .NET area is Microsoft’s own <a href=\"https://docs.microsoft.com/en-us/dotnet/core/extensions/logging\">ILogger (Microsoft.Extensions.Logging)</a>, <a href=\"https://logging.apache.org/log4net/\">log4net</a>, <a href=\"https://nlog-project.org/\">NLog</a> and <a href=\"https://serilog.net/\">Serilog</a>. What they all have in common is, that they are highly flexible in terms of configuration, usage and storage of the logs. On the other hand, they are fat beasts, you have to learn to handle first and you have to deliver with the program always. The latter does not apply to the ILogger, but Microsoft has been known to complicate things so unnecessarily that it is almost no fun anymore.</p>\n<p>Many times this overload is simply not necessary, when you just need a log file for each run of your console application. Let me show you, how to achieve this with a dead simple <code>StringBuilder</code>…</p>\n<span id=\"more\"></span>\n\n<p>Lets start in the <code>Program.cs</code> of a new .NET Core 6 console application. As you may know, in this version MS has changed the entry point <code>static void Main(string[] args)</code>, which has existed for what feels like centuries, to the so-called <strong>Top-Level Statements</strong>, which means nothing else, that the entry point is now automatically generated … and what most old-school developer think sucks, because you have little control over it anymore. But for this approach we need a global variable and therefore I’ve recreated <code>Main</code> like this:</p>\n<figure class=\"highlight c#\"><figcaption><span>Program.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// TOP-LEVEL STATEMENTS</span></span><br><span class=\"line\">Main.Start(args);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// MAIN MODULE</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span> </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Preparation-of-a-small-senseless-console-application\"><a href=\"#Preparation-of-a-small-senseless-console-application\" class=\"headerlink\" title=\"Preparation of a small senseless console application\"></a>Preparation of a small senseless console application</h2><p>Let’s implement a little bit of the ‘<em>features</em>‘ first, like a new class called <code>DoSomething</code> that does the actual job:</p>\n<figure class=\"highlight c#\"><figcaption><span>DoSomething.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">DoSomething</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Work</span>(<span class=\"params\"><span class=\"built_in\">string</span> param1</span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//... doing heavy work with param1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">MoreWork</span>(<span class=\"params\"><span class=\"built_in\">string</span> param2</span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//... doing more work with param2</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Now let’s process the command line arguments for running the app called <strong>SimplestConsoleFileLogger</strong> like this…</p>\n<p><code>SimplestConsoleFileLogger.exe param1:this param2:that</code></p>\n<p>First we create a new class for holding the parameters…</p>\n<figure class=\"highlight c#\"><figcaption><span>Parameters.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Parameter</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Param1 = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Param2 = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>… and then we populate a new instance of it with the values from the console arguments and run the worker class:</p>\n<figure class=\"highlight c#\"><figcaption><span>Program.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> Parameter PARAMETER = <span class=\"keyword\">new</span> Parameter();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span> </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//Process Arguments</span></span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"built_in\">string</span> arg <span class=\"keyword\">in</span> args)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> a = arg.Split(<span class=\"string\">&#x27;:&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (a[<span class=\"number\">0</span>].ToUpper())</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;PARAM1&quot;</span>: PARAMETER.Param1 = a[<span class=\"number\">1</span>]; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;PARAM2&quot;</span>: PARAMETER.Param1 = a[<span class=\"number\">1</span>]; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"literal\">default</span>: <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DoSomething ds = <span class=\"keyword\">new</span> DoSomething();</span><br><span class=\"line\">    ds.Work(PARAMETER.Param1);</span><br><span class=\"line\">    ds.MoreWork(PARAMETER.Param2);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"The-Logging\"><a href=\"#The-Logging\" class=\"headerlink\" title=\"The Logging\"></a>The Logging</h2><p>Now we have our pretty senseless app and we want to log the jobs of the worker class. First, we have to implement a global variable for holding the log messages and secondly a small method to simplify the handling of the log:</p>\n<figure class=\"highlight c#\"><figcaption><span>Program.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> StringBuilder LOGDATA = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Log</span>(<span class=\"params\"><span class=\"keyword\">params</span> <span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> msg = <span class=\"built_in\">string</span>.Join(<span class=\"string\">&quot; &quot;</span>, args).TrimEnd();</span><br><span class=\"line\">    LOGDATA.AppendLine(msg);</span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The <code>Log</code> methods gets an infinite number of arguments (ParamArray) to assemble a message to log. This we can use now in our worker class:</p>\n<figure class=\"highlight c#\"><figcaption><span>DoSomething.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">DoSomething</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Work</span>(<span class=\"params\"><span class=\"built_in\">string</span> param1</span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//... doing heavy work with param1</span></span><br><span class=\"line\">    Main.Log(<span class=\"string\">&quot;Heavy work done with result&quot;</span>, <span class=\"string\">&quot;SUCCESS&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">MoreWork</span>(<span class=\"params\"><span class=\"built_in\">string</span> param2</span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">//... doing more work with param2</span></span><br><span class=\"line\">    Main.Log(<span class=\"string\">&quot;More work done with result&quot;</span>, <span class=\"string\">&quot;SUCCESS&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You can use <code>Main.Log(...)</code> wherever you want, because its globally available.</p>\n<h3 id=\"Writing-the-log-file\"><a href=\"#Writing-the-log-file\" class=\"headerlink\" title=\"Writing the log file\"></a>Writing the log file</h3><p>Last, but not least, we have to persist the log messages into a file. This should done just before the application ends. For writing the log, we use a <code>StreamWriter</code> object, which accepts our <code>StringBuilder</code>, where the messages are stored in seperate lines. By checking the length of the StringBuilder <code>LOGDATA</code>, we ensure that the log file is only written, when there is something to write.</p>\n<figure class=\"highlight c#\"><figcaption><span>Program.cs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span> </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    HandleEnd();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleEnd</span>()</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (LOGDATA.Length &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"built_in\">string</span> logFile = <span class=\"string\">$&quot;<span class=\"subst\">&#123;DateTime.Now.ToString(<span class=\"string\">&quot;u&quot;</span>).Replace(<span class=\"string\">&quot;:&quot;</span>,<span class=\"string\">&quot;-&quot;</span>)&#125;</span>.log&quot;</span>;</span><br><span class=\"line\">      <span class=\"built_in\">string</span> logFilePath = Path.Combine(Environment.CurrentDirectory, logFile);</span><br><span class=\"line\">      StreamWriter logStream = <span class=\"keyword\">new</span> StreamWriter(logFilePath, <span class=\"literal\">true</span>, Encoding.UTF8);</span><br><span class=\"line\">      logStream.Write(LOGDATA);</span><br><span class=\"line\">      logStream.Close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>That’s it. As you see, the important parts are the globally available <code>StringBuilder</code> and the persistance of the messages in a file at the end. With this you can customize the messages as fancy as you want and you don’t need one of the logging beasts.</p>\n<p><strong>Download the files via <a href=\"https://gist.github.com/kristofzerbe/4f80cb67e5a3d65c0f7d528af493bf5c\">Gist</a></strong></p>\n","_path":"post/Simplest-Console-File-Logger/","_link":"https://kiko.io/post/Simplest-Console-File-Logger/","_id":"cln5rjuhd002rk4p432n1apkk"}}