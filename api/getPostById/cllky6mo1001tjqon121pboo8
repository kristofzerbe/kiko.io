{"type":"getPostById","data":{"title":"Pattern for dynamic Hexo pages","date":"2021-08-25T07:43:44.000Z","description":"<p><a href=\"https://hexo.io/\">Hexo</a> is a great SSG platform for blogging. Just write your Markdown beneath some Frontmatter meta data, run <code>hexo generate</code> and publish the results to a web server.</p>\n<p>But at some point you may want to process different data from internal or external sources and integrate it into your blog. Hexo doesn’t support this out of the box, but has a powerful feature called <a href=\"https://hexo.io/api/generator.html\">Generator</a>, which helps you to achieve your goal. The following is a sample and pattern of how to implement this.</p>\n<p>The starting point of my example is the requirement to display several elements of the same type on a dynamic page, but you can of course adapt the example according to your needs.</p>","categories":[{"name":"Tools","_id":"cllky6mpx003ljqon5uy31n8d"}],"tags":[{"name":"Hexo","_id":"cllky6mpw003gjqon02am43lc"},{"name":"Blogging","_id":"cllky6mq3003yjqonf5eh4u4r"}],"content":"<p><a href=\"https://hexo.io/\">Hexo</a> is a great SSG platform for blogging. Just write your Markdown beneath some Frontmatter meta data, run <code>hexo generate</code> and publish the results to a web server.</p>\n<p>But at some point you may want to process different data from internal or external sources and integrate it into your blog. Hexo doesn’t support this out of the box, but has a powerful feature called <a href=\"https://hexo.io/api/generator.html\">Generator</a>, which helps you to achieve your goal. The following is a sample and pattern of how to implement this.</p>\n<p>The starting point of my example is the requirement to display several elements of the same type on a dynamic page, but you can of course adapt the example according to your needs.</p>\n<span id=\"more\"></span>\n\n<hr>\n<h2 id=\"The-Page\"><a href=\"#The-Page\" class=\"headerlink\" title=\"The Page\"></a>The Page</h2><p>First of all we need a Hexo page for the meta data and for some text we want to show at the beginning of the page to describe what is shown below. In order not to interfer the classic post generation, we create a new folder in Hexo’s <code>source</code> folder called <strong><code>_dynamic</code></strong>, where we place the MD file for the new dynamic page.</p>\n\n    <div class=\"alertbox alertbox-exclamation\">\n      <p>The underscore in the name of the folder <code>_dynamic</code> is important, because Hexo doesn’t touch subfolders in <code>source</code> with this starting character while generating the site. Without, it would be treated as a normal page.</p>\n\n    </div>\n  \n\n<figure class=\"highlight md\"><figcaption><span>./source/_dynamic/my-special-page.md</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: My Title</span><br><span class=\"line\">subtitle: My Subtitle</span><br><span class=\"line\">date: 2021-08-24 19:24:00</span><br><span class=\"line\"><span class=\"section\">mySpecialProperty: &quot;Lorem ipsum dolor sit amet&quot;</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br><span class=\"line\"></span><br><span class=\"line\">Some text to show above the dynamic created content...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>The Frontmatter data has no limits. You can add as much properties as you like.</p>\n<hr>\n<h2 id=\"The-Layout-Template\"><a href=\"#The-Layout-Template\" class=\"headerlink\" title=\"The Layout Template\"></a>The Layout Template</h2><p>Hexo works with EJS layout files. Whenever a page should be created, the calling method has to define which layout file should be used. Therefor we create a special EJS file for our dynamic page and place it in the <code>layout</code> folder.</p>\n<figure class=\"highlight js\"><figcaption><span>./themes/&lt;your-theme&gt;/layout/my-special-layout.ejs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;h1 <span class=\"keyword\">class</span>=<span class=\"string\">&quot;page-title&quot;</span>&gt;&lt;%= page.<span class=\"property\">title</span> %&gt;&lt;/h1&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;page-subtitle&quot;</span>&gt;</span>&lt;%= page.subtitle %&gt;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;page-content&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  &lt;%- page.content %&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;view grid&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    &lt;% for(var i=0; i &lt; page.items.length; i++) &#123; %&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &lt;%- partial(&#x27;_partial/my-special-item&#x27;, &#123; item: page.items[i] &#125;) %&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">    &lt;% &#125; %&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>  </span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"comment\">// Extend the page with JavaScript ...</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>On generating the page later on, an object called <code>page</code> will be used to process the EJS, with all information we want to show on the page, like <code>content</code> (text of the Markdown file) and all meta data from the Frontmatter (title, subtitle and so on).</p>\n<p>Special attention is paid to <strong><code>items</code></strong>, because this property holds the list of all items we want to show on the page. Each object in this list have multiple custom properties you define, when you are assemble the data to show in the generator, but more about that later.</p>\n<p>In the <code>script</code> tag you can write JavaScript to interact with your data on the page, like filtering stuff or other things the user should can do with your data.</p>\n<hr>\n<h2 id=\"The-Partial-Template-For-Items\"><a href=\"#The-Partial-Template-For-Items\" class=\"headerlink\" title=\"The Partial Template For Items\"></a>The Partial Template For Items</h2><p>In order not to blow up the layout EJS, it is advisable to separate the template for the item itself to an extra file, referenced in the layout file (<code>_partial/my-special-item</code>) as a Partial.</p>\n<figure class=\"highlight js\"><figcaption><span>./themes/&lt;your-theme&gt;/layout/_partial/my-special-item.ejs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div <span class=\"keyword\">class</span>=<span class=\"string\">&quot;my-item&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!-- <span class=\"title class_\">Definition</span> <span class=\"keyword\">of</span> an item --&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<p>The layout EJS will iterate over the list of items in the FOR loop and handover one of these object to the Partial to render.</p>\n<hr>\n<h2 id=\"The-Generator\"><a href=\"#The-Generator\" class=\"headerlink\" title=\"The Generator\"></a>The Generator</h2><p>As we have made our preparations, we are now able to implement our special generator itself.</p>\n<p>Hexo uses so called Generators to “produce” the HTML for your site and you can add your own by using the <code>register</code> method. The result of a generator has to be an object with at least three properties:</p>\n<ul>\n<li><code>data</code> - Data object with all necessary information to process the given layout EJS</li>\n<li><code>path</code> - The path where the HTML file should be created</li>\n<li><code>layout</code> - The layout EJS file, which should be processed</li>\n</ul>\n<figure class=\"highlight js\"><figcaption><span>./themes/&lt;your-theme&gt;/scripts/my-special-generator.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">generator</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&quot;my-special-generator&quot;</span>, <span class=\"keyword\">async</span> <span class=\"keyword\">function</span>(<span class=\"params\">locals</span>) &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// INSTANTIATE A NEW DATA OBJECT</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> page = &#123;&#125;;</span><br><span class=\"line\">  page.<span class=\"property\">name</span> = <span class=\"string\">&quot;my-special-page&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Do something to get content and data for the page</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// INSTANTIATE THE RESULT OBJECT</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = &#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: page,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: path.<span class=\"title function_\">join</span>(page.<span class=\"property\">name</span>, <span class=\"string\">&quot;index.html&quot;</span>),</span><br><span class=\"line\">    <span class=\"attr\">layout</span>: <span class=\"string\">&quot;my-special-layout&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// RETURN THE RESULT</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;  </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>In this basic structure, you will find again the layout file, we created earlier. The output will be rendered in an HTML file called <code>index.html</code> at the subfolder <code>my-special-page</code>, as we take the name of the page for it, as we did it for the name of the source MD file.</p>\n<p>The next thing we have to implement here, is the content of the source MD file.</p>\n\n    <div class=\"alertbox alertbox-info\">\n      <p>The parameter <code>locals</code> gives you access to the site variables, with all information about the site and its pages, posts, categories and tags!</p>\n\n    </div>\n  \n\n<p>The first 4 lines in the following script are the references to some helpers we need. Please be sure, that you install them first via <code>npm install</code>.</p>\n<figure class=\"highlight js\"><figcaption><span>./themes/&lt;your-theme&gt;/scripts/my-special-generator.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> log = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-log&#x27;</span>)(&#123; <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>, <span class=\"attr\">silent</span>: <span class=\"literal\">false</span> &#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> front = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-front-matter&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">generator</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&quot;my-special-generator&quot;</span>, <span class=\"keyword\">async</span> <span class=\"keyword\">function</span>(<span class=\"params\">locals</span>) &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// GET REFERENCE TO HEXO&#x27;S CONFIGURATION</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> config = <span class=\"variable language_\">this</span>.<span class=\"property\">config</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// SHOW MESSAGE ON GENERATING</span></span><br><span class=\"line\">  log.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;Processing items for dynamic page&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> page = &#123;&#125;;</span><br><span class=\"line\">  page.<span class=\"property\">name</span> = <span class=\"string\">&quot;my-special-page&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// GET THE PATH TO THE SOURCE FILE</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> mdSource = path.<span class=\"title function_\">join</span>(config.<span class=\"property\">source_dir</span>, <span class=\"string\">&quot;_dynamic&quot;</span>, page.<span class=\"property\">name</span> + <span class=\"string\">&quot;.md&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// GET THE CONTENT OF THE SOURCE FILE</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> md = fs.<span class=\"title function_\">readFileSync</span>(mdSource);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// PARSE THE FRONTMATTER OF THE SOURCE FILE</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> fm = front.<span class=\"title function_\">parse</span>(md);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ADD THE FRONTMATTER TO THE DATA OBJECT</span></span><br><span class=\"line\">  page = &#123;...page, ...fm&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// CONVERT MARKDOWN CONTENT OF THE SOURCE FILE INTO HTML</span></span><br><span class=\"line\">  page.<span class=\"property\">content</span> = hexo.<span class=\"property\">render</span>.<span class=\"title function_\">renderSync</span>(&#123; <span class=\"attr\">text</span>: page.<span class=\"property\">_content</span>, <span class=\"attr\">engine</span>: <span class=\"string\">&#x27;markdown&#x27;</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Do something to get items data for the page</span></span><br><span class=\"line\">  <span class=\"comment\">//page.items = [];</span></span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = &#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: page,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: path.<span class=\"title function_\">join</span>(page.<span class=\"property\">name</span>, <span class=\"string\">&quot;index.html&quot;</span>),</span><br><span class=\"line\">    <span class=\"attr\">layout</span>: <span class=\"string\">&quot;my-special-layout&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;  </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>The only thing missing now, is your implemention of filling <code>page.items</code> with a list of objects you want to show on the page. There are no limits to your imagination. Get data from external API’s or process JSON data, stored in the <code>data</code> folder … or whatever you prefer.</p>\n<p>A live example of this approach are the pages <a href=\"/collections/tiny-tools/\">TINY TOOLS</a> (processing data from the Trello API) and <a href=\"/photos\">PHOTOS</a> here on this blog.</p>\n","_path":"post/Pattern-for-dynamic-Hexo-pages/","_link":"https://kiko.io/post/Pattern-for-dynamic-Hexo-pages/","_id":"cllky6mo1001tjqon121pboo8"}}