{"type":"getPostByPath","data":{"title":"Using GitHub as Commenting Platform","date":"2020-07-05T12:55:16.000Z","description":"<p>If you run a blog, it is always advisable to integrate a commenting system, in order to get feedback on your posts from your readers.</p>\n<p>So did I, when I start this blog and I decided to use the <a href=\"https://disqus.com/\">Disqus platform</a>, as it was very easy to integrate … but I always had a bad feeling about a third-party platform collecting data from my readers. Disqus is probably not without reason under criticism by many people in the community.</p>\n<p>As I host this blog at GitHub (see <a href=\"/categories/Tools/A-New-Blog-VS-Code-Hexo-and-GitHub-Pages/\">A New Blog (Part One): VS Code, Hexo and GitHub Pages</a>) I was looking for a solution to host the comments also on my prefered platform. There were some solutions, which uses GitHub Issues for this and wanted to implement something like that someday.</p>","categories":[{"name":"Tools","_id":"clkcurc5a003airoo64494i3r"}],"tags":[{"name":"Hexo","_id":"clkcurc5b003diroobec3fe73"},{"name":"GitHub","_id":"clkcurc5d003firoogymb5k1w"},{"name":"Blogging","_id":"clkcurc5e003hiroo5rjt0ont"}],"content":"<p>If you run a blog, it is always advisable to integrate a commenting system, in order to get feedback on your posts from your readers.</p>\n<p>So did I, when I start this blog and I decided to use the <a href=\"https://disqus.com/\">Disqus platform</a>, as it was very easy to integrate … but I always had a bad feeling about a third-party platform collecting data from my readers. Disqus is probably not without reason under criticism by many people in the community.</p>\n<p>As I host this blog at GitHub (see <a href=\"/categories/Tools/A-New-Blog-VS-Code-Hexo-and-GitHub-Pages/\">A New Blog (Part One): VS Code, Hexo and GitHub Pages</a>) I was looking for a solution to host the comments also on my prefered platform. There were some solutions, which uses GitHub Issues for this and wanted to implement something like that someday.</p>\n<span id=\"more\"></span>\n\n<p>As I read a post from on <a href=\"https://thomaslevesque.com/\">Thomas Lavesques’ blog</a>, to solve another problem, his commenting section came to my attention: <strong><a href=\"https://utteranc.es/\">utteranc.es</a></strong> … exactly the solution I needed! Thanx guys…</p>\n<p>On their website is a small configurator for a script to implement in each post, which needs only few information:</p>\n<ul>\n<li>Name of the Repo</li>\n<li>How the mapping of the post to the Issues should work</li>\n<li>Name of the Theme, in order to fit to the colors of the blog</li>\n</ul>\n<p>The script had to be included to my Hexo <code>article.js</code>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (!index &amp;&amp; post.comments)&#123; %&gt;</span><br><span class=\"line\">  &lt;script src=&quot;https://utteranc.es/client.js&quot;</span><br><span class=\"line\">    repo=&quot;kristofzerbe/kiko.io&quot;</span><br><span class=\"line\">    issue-term=&quot;pathname&quot;</span><br><span class=\"line\">    theme=&quot;github-light&quot;</span><br><span class=\"line\">    crossorigin=&quot;anonymous&quot;</span><br><span class=\"line\">    async&gt;</span><br><span class=\"line\">  &lt;/script&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n<p>That’s pretty much it. On entering the first comment, Utterances told me to install the needed GitHub App to my repo, in order to make it work … and done.</p>\n<p><img src=\"/post/Using-GitHub-as-Commenting-Platform/utteranc-github-app.png\" alt=\"Utterances GitHub App\"></p>\n<p>The result you see below …</p>\n<h2 id=\"UPDATE…\"><a href=\"#UPDATE…\" class=\"headerlink\" title=\"UPDATE…\"></a>UPDATE…</h2><p>The utterances script tag has the attribute <code>theme</code>, to tell utterances  which style should be delivered. There are several themes available, but if users are able to switch between light or dark mode on the page (see <a href=\"/categories/Tools/Hexo-and-the-Dark-Mode\">Hexo and the Dark Mode</a>), the comment block should change to an suitable theme also.</p>\n<p>On order to respond on a mode change, it is necessary to write a more dynamic script loading.</p>\n<p>First we define a function in a global script file to load the utterances script via JS:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">insertUtterancesCommentBlock</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> commentTheme = <span class=\"string\">&quot;github-light&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;theme&quot;</span>) === <span class=\"string\">&quot;dark&quot;</span>)&#123;</span><br><span class=\"line\">      commentTheme = <span class=\"string\">&quot;github-dark&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> scriptId = <span class=\"string\">&quot;comment-theme-script&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> existingScript = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(scriptId);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!existingScript) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> commentScript = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;script&quot;</span>);</span><br><span class=\"line\">      commentScript.<span class=\"property\">id</span> = scriptId;</span><br><span class=\"line\">      commentScript.<span class=\"property\">src</span> = <span class=\"string\">&quot;https://utteranc.es/client.js&quot;</span>;</span><br><span class=\"line\">      commentScript.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&quot;repo&quot;</span>, <span class=\"string\">&quot;kristofzerbe/kiko.io&quot;</span>);</span><br><span class=\"line\">      commentScript.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&quot;issue-term&quot;</span>, <span class=\"string\">&quot;pathname&quot;</span>);</span><br><span class=\"line\">      commentScript.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&quot;theme&quot;</span>, commentTheme);</span><br><span class=\"line\">      commentScript.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&quot;crossorigin&quot;</span>, <span class=\"string\">&quot;anonymous&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">const</span> placeholder = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;comment-placeholder&quot;</span>);</span><br><span class=\"line\">      placeholder.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">      placeholder.<span class=\"title function_\">appendChild</span>(commentScript);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Then we change the placement in the EJS file, by defining a placeholder  and ensuring that the script above is loaded, before we call it:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;comment-placeholder&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  window.addEventListener(&#x27;load&#x27;, function () &#123;</span><br><span class=\"line\">    insertUtterancesCommentBlock();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>On my blog, everytime the user switches between light&#x2F;dark mode the <code>body</code> tag will be decorated with the data tag <code>data-theme</code> and the value of the mode. To keep the loading of the utterances script independent from this functionality, we just have to listen to this change via <code>MutationObserver</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//observe theme change, to adjust comment block theme</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> target = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>,</span><br><span class=\"line\">    observer = <span class=\"keyword\">new</span> <span class=\"title class_\">MutationObserver</span>(<span class=\"keyword\">function</span>(<span class=\"params\">mutations</span>) &#123;</span><br><span class=\"line\">        mutations.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span>(<span class=\"params\">mutation</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mutation.<span class=\"property\">attributionName</span> === <span class=\"string\">&quot;data-theme&quot;</span> );</span><br><span class=\"line\">                <span class=\"title function_\">insertUtterancesCommentBlock</span>();</span><br><span class=\"line\">            &#125;);        </span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    config = &#123; <span class=\"attr\">attributes</span>: <span class=\"literal\">true</span> &#125;;</span><br><span class=\"line\">observer.<span class=\"title function_\">observe</span>(target, config);</span><br></pre></td></tr></table></figure>","_path":"post/Using-GitHub-as-Commenting-Platform/","_link":"https://kiko.io/post/Using-GitHub-as-Commenting-Platform/","_id":"clkcurc1m000ziroo01w5e20e"}}