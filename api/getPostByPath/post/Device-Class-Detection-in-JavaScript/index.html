{"type":"getPostByPath","data":{"title":"Device Class Detection in JavaScript","date":"2020-09-28T13:27:17.000Z","description":"<p>In some occasions it is necessary to know which device a user is using while writing JavaScript Web Apps. Should be nothing regarding layout, because for this we have <a href=\"https://developer.mozilla.org/de/docs/Web/CSS/Media_Queries/Using_media_queries\"><code>CSS Media Queries</code></a>. </p>\n<p>Somewhere around 2011 W3C introduced <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\"><code>matchMedia()</code></a>, which <em>returns a MediaQueryList object that can be used to detemnine if the document matches the media query string.</em> The using is pretty straightforward and feels a bit like RegEx matching in JS:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mediaQuery = <span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&#x27;(min-width: 1025px)&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> (mediaQuery.<span class=\"property\">matches</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something...  </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>If you are interested in this API, you will find good introductions to the topic <a href=\"https://css-tricks.com/working-with-javascript-media-queries/\">here</a>, <a href=\"https://hacks.mozilla.org/2012/06/using-window-matchmedia-to-do-media-queries-in-javascript/\">here</a> and <a href=\"https://www.mediaevent.de/javascript/window-matchMedia.html\">here (German)</a>.</p>\n<p>One point of criticism on this pure JS approach can be, that you have to maintain the breakpoints in addition to CSS … <strong>but why not use these existing breakpoints in JS</strong>?</p>","categories":[{"name":"JavaScript","_id":"clm3qodse003qjnozdfrn9205"}],"tags":[{"name":"CSS","_id":"clm3qodsb003ljnoz4ta96lw2"},{"name":"Browser","_id":"clm3qodsb003njnoz0tqp5lkv"},{"name":"MediaQuery","_id":"clm3qodt5005ijnozbxga0h5p"}],"content":"<p>In some occasions it is necessary to know which device a user is using while writing JavaScript Web Apps. Should be nothing regarding layout, because for this we have <a href=\"https://developer.mozilla.org/de/docs/Web/CSS/Media_Queries/Using_media_queries\"><code>CSS Media Queries</code></a>. </p>\n<p>Somewhere around 2011 W3C introduced <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\"><code>matchMedia()</code></a>, which <em>returns a MediaQueryList object that can be used to detemnine if the document matches the media query string.</em> The using is pretty straightforward and feels a bit like RegEx matching in JS:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mediaQuery = <span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&#x27;(min-width: 1025px)&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> (mediaQuery.<span class=\"property\">matches</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something...  </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>If you are interested in this API, you will find good introductions to the topic <a href=\"https://css-tricks.com/working-with-javascript-media-queries/\">here</a>, <a href=\"https://hacks.mozilla.org/2012/06/using-window-matchmedia-to-do-media-queries-in-javascript/\">here</a> and <a href=\"https://www.mediaevent.de/javascript/window-matchMedia.html\">here (German)</a>.</p>\n<p>One point of criticism on this pure JS approach can be, that you have to maintain the breakpoints in addition to CSS … <strong>but why not use these existing breakpoints in JS</strong>?</p>\n<span id=\"more\"></span>\n\n<p>If you implement a feature that is based on the different device classes, you don’t have to determine the current class with dozens of lines of JavaScript code, if you just can ask the DOM.</p>\n<h2 id=\"The-CSS-JS-Breakpoint-Hack\"><a href=\"#The-CSS-JS-Breakpoint-Hack\" class=\"headerlink\" title=\"The CSS&#x2F;JS Breakpoint Hack\"></a>The CSS&#x2F;JS Breakpoint Hack</h2><p>For this approach, we take advantage of the fact, that CSS can be used to define not only styles, but also content. We always use it, when showing an icon by using a symbol font like FontAwesome:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my-fancy-<span class=\"attribute\">icon</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: FontAwesome5Solid;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">&quot;\\f186&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Mixed with a <code>@media</code> rule, we can “inject” the needed device value into the DOM, for example into the <code>BODY</code> tag, but you can take whatever you want:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@media</span> (<span class=\"attribute\">min-width</span>: <span class=\"number\">1025px</span>) &#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">body</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">&quot;DESKTOP&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Just one line more in the masses of CSS code to make a Web App responsive, but with this one you can do without many lines of JS.</p>\n<p>Now you can read out this value via JavaScript by getting the styles of the tag and get the injected content:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> style = <span class=\"variable language_\">window</span>.<span class=\"title function_\">getComputedStyle</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;body&quot;</span>), <span class=\"string\">&quot;:before&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> breakpoint = style.<span class=\"title function_\">getPropertyValue</span>(<span class=\"string\">&quot;content&quot;</span>).<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\&quot;/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>It is advisable to embed this request into an event listener of <code>DOMContentLoaded</code>, because the rule has to be set, before you can access it.</p>\n<p>See a simple working pen:</p>\n\n    <iframe height=\"400\" \n        id=\"codepen-WNwWjBR\"\n        class=\"codepen\"\n        src=\"https://codepen.io/kristofzerbe/embed/WNwWjBR?height=400&default-tab=css&theme-id=dark\"\n        style=\"width: 100%;\" \n        scrolling=\"no\" \n        title=\"Codepen: CSS/JS Breakpoint Hack\" \n        frameborder=\"no\" \n        loading=\"lazy\" \n        allowtransparency=\"true\" \n        allowfullscreen=\"true\">\n    </iframe>\n  \n","_path":"post/Device-Class-Detection-in-JavaScript/","_link":"https://kiko.io/post/Device-Class-Detection-in-JavaScript/","_id":"clm3qodon000kjnoze99g1gpu"}}