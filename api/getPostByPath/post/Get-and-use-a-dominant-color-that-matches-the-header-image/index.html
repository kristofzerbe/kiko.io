{"type":"getPostByPath","data":{"title":"Get and use a dominant color that matches the header image","date":"2023-10-10T13:34:57.000Z","description":"<p>The pages of this website are all structured according to the scheme <strong>Header</strong>, <strong>Content</strong>, <strong>Footer</strong>, where the header contains an individual hero image and, like the footer, has a dark gray background color. I chose dark gray at the time because I needed contrast and it matches all the other colors, since the header image is slowly overlaid by the header background color as you scroll.</p>\n<p>In July last year, in <a href=\"/post/Discoveries-19-Visual-Helpers/\" title=\"Discoveries #19 - Visual Helpers\">Discoveries #19 - Visual Helpers</a>, I introduced two tools that deal with determining the dominant color from an image, and since then I’ve been buzzing around in my head about using one of them to color the header and footer to match the image.</p>\n<p>After a short testing period I decided to use <a href=\"https://github.com/Vibrant-Colors\">Vibrant Colors</a> (also because of the good example by Konstantin Polunin on <a href=\"https://codepen.io/kopol/details/QWjwrPN\">Codepen</a>) and how it works and how I had to adapt the results to my needs I want to highlight in this post.</p>","categories":[{"name":"JavaScript","_id":"clp3x5rzb0046mlokgsg54lnh"}],"tags":[{"name":"CSS","_id":"clp3x5rz9003zmloka01459hi"},{"name":"Imaging","_id":"clp3x5s1800b0mlokdxodblx9"},{"name":"Theming","_id":"clp3x5s1q00d4mlok2o2061aw"}],"content":"<p>The pages of this website are all structured according to the scheme <strong>Header</strong>, <strong>Content</strong>, <strong>Footer</strong>, where the header contains an individual hero image and, like the footer, has a dark gray background color. I chose dark gray at the time because I needed contrast and it matches all the other colors, since the header image is slowly overlaid by the header background color as you scroll.</p>\n<p>In July last year, in <a href=\"/post/Discoveries-19-Visual-Helpers/\" title=\"Discoveries #19 - Visual Helpers\">Discoveries #19 - Visual Helpers</a>, I introduced two tools that deal with determining the dominant color from an image, and since then I’ve been buzzing around in my head about using one of them to color the header and footer to match the image.</p>\n<p>After a short testing period I decided to use <a href=\"https://github.com/Vibrant-Colors\">Vibrant Colors</a> (also because of the good example by Konstantin Polunin on <a href=\"https://codepen.io/kopol/details/QWjwrPN\">Codepen</a>) and how it works and how I had to adapt the results to my needs I want to highlight in this post.</p>\n<span id=\"more\"></span>\n\n<p>The work on the project <a href=\"https://github.com/Vibrant-Colors/node-vibrant\">node-vibrant</a>, is probably based on <a href=\"https://github.com/jariz/vibrant.js/\">vibrant.js</a> (at least this archived repo refers to it) and is actually a Node.js solution, but you can also just use it in the browser. Since the determination of the total of 6 different colors (<strong>Vibrant</strong>, <strong>Muted</strong> and both with its variants of <strong>Light</strong> und <strong>Dark</strong> mode) from an image can possibly lead to performance problems in the browser, the maintainers have focused on Node.js and also built in a WebWorker solution. My approach is based on the already fully loaded page, including the header image and the display with the original dark gray background color. So the new color is simply icing and thus should not lead to problems.</p>\n<p>Here is an example of the 6 extracted colors with one of my images from Konstantine’s codepen, mentioned above:</p>\n\n    <a href=\"https://codepen.io/kopol/details/QWjwrPN\">\n        <img src=\"codepen-sample-kopol-QWjwrPN.png\" alt=\"Vibrant Codepen Sample\" />\n    </a>\n    \n\n<hr>\n<h2 id=\"Setup\"><a href=\"#Setup\" class=\"headerlink\" title=\"Setup\"></a>Setup</h2><p>The installation is done quickly … Execute <code>npm install node-vibrant</code> in the console, copy out the file <strong>vibrant.min.js</strong> into the distribution script folder and include it into the HTML page header:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/js/dist/vibrant.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Preparation\"><a href=\"#Preparation\" class=\"headerlink\" title=\"Preparation\"></a>Preparation</h2><p>Depending on the size of the image to be read out, the determination may take some time. Therefore, it is advisable, as in my case, not only to compress the images, but also to let them preload in the head of the page. For this you can use the <code>rel=preload</code> mechanism, which ensures that a resource is loaded fast.</p>\n\n    <div>\n        <blockquote><p>The preload value of the <link> element’s rel attribute lets you declare fetch requests in the HTML’s <head>, specifying resources that your page will need very soon, which you want to start loading early in the page lifecycle, before browsers’ main rendering machinery kicks in.</p>\n</blockquote>\n        <cite><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/preload\">--- MDN Web Docs</a></cite>\n    </div>\n  \n\n<p>By adding an ID to the LINK it will be easy later on to get the URL of the image to throw at the library:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;preload&quot;</span> <span class=\"attr\">as</span>=<span class=\"string\">&quot;image&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">id</span>=<span class=\"string\">&quot;photo-preload&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">href</span>=<span class=\"string\">&quot;/photos/normal/20-08 Mallorca-7333.jpg&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">imagesrcset</span>=<span class=\"string\">&quot;/photos/mobile/20-08 Mallorca-7333.jpg 480w, /photos/tablet/20-08 Mallorca-7333.jpg 768w&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Usage-First-Attempt\"><a href=\"#Usage-First-Attempt\" class=\"headerlink\" title=\"Usage, First Attempt\"></a>Usage, First Attempt</h2><p>Thus prepared, it is easy to read out the preferred RGB color value in a script that is embedded in the footer of the page, using Vibrant Color:</p>\n<figure class=\"highlight js\"><figcaption><span>after-footer.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setVibrantColor</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// get url of preloaded image</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> img = $(<span class=\"string\">&quot;#photo-preload&quot;</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&quot;href&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// call Vibrant Color</span></span><br><span class=\"line\">  <span class=\"title class_\">Vibrant</span>.<span class=\"title function_\">from</span>(img).<span class=\"title function_\">getPalette</span>().<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">palette</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get vibrant color swatch</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> swatch = palette.<span class=\"property\">Vibrant</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// helper to format output</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">_rgbToString</span> = (<span class=\"params\">_rgb</span>) =&gt; <span class=\"string\">`rgb(<span class=\"subst\">$&#123;_rgb[<span class=\"number\">0</span>]&#125;</span>, <span class=\"subst\">$&#123;_rgb[<span class=\"number\">1</span>]&#125;</span>, <span class=\"subst\">$&#123;_rgb[<span class=\"number\">2</span>]&#125;</span>)`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get formatted RGB value of swatch</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rgb = <span class=\"title function_\">_rgbToString</span>(swatch.<span class=\"title function_\">getRgb</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// set new background color to header and footer</span></span><br><span class=\"line\">    $(<span class=\"string\">&quot;#header, #footer&quot;</span>).<span class=\"title function_\">css</span>(<span class=\"string\">&quot;background-color&quot;</span>, rgb);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"variable language_\">document</span>).<span class=\"title function_\">ready</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setVibrantColor</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>The MUTED variants were out of the question for me after a bit of trial and error, because for me this color has too little to do with what the eye immediately draws out of the image. This can be seen in the example above: the green of the MUTED colors is by no means dominant. That’s why I decided to use VIBRANT.</p>\n<hr>\n<h2 id=\"Usage-Second-Attempt\"><a href=\"#Usage-Second-Attempt\" class=\"headerlink\" title=\"Usage, Second Attempt\"></a>Usage, Second Attempt</h2><p>But there is also a problem with the VIBRANT variant: under certain circumstances the extracted color is <strong>too bright</strong> for the background with white text in the foreground. Vibrant Color offers the possibility to create matching text colors, but neither worked for me, nor did I want to get away from white. If you additionally offer a dark theme like I do, the selected color will definitely be too light.</p>\n<p>Besides the possibility to read out the RGB color from the so-called swatches, the library also offers the output <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/hsl\">HSL (Hue&#x2F;Saturation&#x2F;Lightness)</a>. By adjusting the L-value downwards, the desired contrast can be achieved again.</p>\n<p>The HSL values in Vibrant Colors are only available as decimal numbers, i.e. it is necessary to convert them using the HSL specification:</p>\n<figure class=\"highlight js\"><figcaption><span>after-footer.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setVibrantColor</span>(<span class=\"params\">theme</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// get url of preloaded image</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> img = $(<span class=\"string\">&quot;#photo-preload&quot;</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&quot;href&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// call Vibrant Color</span></span><br><span class=\"line\">  <span class=\"title class_\">Vibrant</span>.<span class=\"title function_\">from</span>(img).<span class=\"title function_\">getPalette</span>().<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">palette</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get vibrant color swatch</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> swatch = palette.<span class=\"property\">Vibrant</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get HSL from swatch and convert values</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> _hsl = swatch.<span class=\"title function_\">getHsl</span>();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> h = (_hsl[<span class=\"number\">0</span>] * <span class=\"number\">360</span>); <span class=\"comment\">// in relation to the HSL color wheel</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> s = (_hsl[<span class=\"number\">1</span>] * <span class=\"number\">100</span>); <span class=\"comment\">// percentage</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> l = (_hsl[<span class=\"number\">2</span>] * <span class=\"number\">100</span>); <span class=\"comment\">// percentage</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// overwrite l with new fixed hue depending on theme</span></span><br><span class=\"line\">    l = (theme === <span class=\"string\">&quot;dark&quot;</span>) ? <span class=\"number\">20</span> : <span class=\"number\">35</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// helper to format output, limited to 4 decimal places</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">_hslToString</span> = (<span class=\"params\">h, s, l</span>) =&gt; </span><br><span class=\"line\">      <span class=\"string\">`hsl(<span class=\"subst\">$&#123;h.toFixed(<span class=\"number\">4</span>)&#125;</span>, <span class=\"subst\">$&#123;s.toFixed(<span class=\"number\">4</span>)&#125;</span>%, <span class=\"subst\">$&#123;l.toFixed(<span class=\"number\">4</span>)&#125;</span>%)`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get formatted HSL value</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hsl = <span class=\"title function_\">_hslToString</span>(h, s, l);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// set new background color to header and footer</span></span><br><span class=\"line\">    $(<span class=\"string\">&quot;#header, #footer&quot;</span>).<span class=\"title function_\">css</span>(<span class=\"string\">&quot;background-color&quot;</span>, hsl);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Usage-Final-Attempt\"><a href=\"#Usage-Final-Attempt\" class=\"headerlink\" title=\"Usage, Final Attempt\"></a>Usage, Final Attempt</h2><p>HSL generally has the problem that colors appear brighter than others depending on the saturation. Therefore, the <a href=\"https://en.wikipedia.org/wiki/HSL_and_HSV\">HSV color model</a> is often preferred, because it corresponds more closely to human color perception.</p>\n<p>A complete conversion to HSV seemed a bit too much for my case. Therefore, I limited myself to downscaling the lightness proportionally from a saturation value of 70%:</p>\n<figure class=\"highlight js\"><figcaption><span>after-footer.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setVibrantColor</span>(<span class=\"params\">theme</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// overwrite l with new fixed hue depending on theme</span></span><br><span class=\"line\">    l = (theme === <span class=\"string\">&quot;dark&quot;</span>) ? <span class=\"number\">20</span> : <span class=\"number\">35</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// calculate hue reduction when saturation too high</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> reduce = (s &gt; <span class=\"number\">70</span>) ? <span class=\"number\">10</span> - ((<span class=\"number\">100</span> - s) / <span class=\"number\">4</span>) : <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// take half of reduction when dark theme</span></span><br><span class=\"line\">    l -= (theme === <span class=\"string\">&quot;dark&quot;</span>) ? reduce / <span class=\"number\">2</span> : reduce; </span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"The-Result\"><a href=\"#The-Result\" class=\"headerlink\" title=\"The Result\"></a>The Result</h3><p>The result convinces me, even if it is not (yet) perfect. But that is primarily due to the choice of the dominant color of the library. According to my color perception, it could be different from time to time … like for example for the page of this post. My eye would have expected some kind of violet. </p>\n<p>But on other pages it works fine, even the reduced lightness, because my header image at the top is darkened too with a gradient to let the text pop out more.</p>\n<img src=\"/post/Get-and-use-a-dominant-color-that-matches-the-header-image/scroll-header-vibrant-back.gif\" title=\"Scrolling with default dark vibrant header background\" style=\"max-width: 40vw\" />\n","_path":"post/Get-and-use-a-dominant-color-that-matches-the-header-image/","_link":"https://kiko.io/post/Get-and-use-a-dominant-color-that-matches-the-header-image/","_id":"clp3x5ry20038mlok6min7m8s"}}