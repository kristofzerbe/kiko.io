{"type":"getPostByPath","data":{"title":"Generate Social Media Images Automatically","date":"2021-07-10T09:07:31.000Z","description":"<p>From day one of this blog I wanted to combine two of my passions: tech stuff and photography. All these photos I have shot myself in recent years and now they are representing my thoughts &amp; findings about digital technology. I wrote about my approach to provide these images in my post <a href=\"/post/Automatic-Header-Images-in-Hexo/\" title=\"Automatic Header Images in Hexo\">Automatic Header Images in Hexo</a>.</p>\n<p>When I share one of my posts on social media I provide the appropriate image as a visual anchor to my writing. The technique behind this are the <code>meta</code> tags in the HTML of my posts:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Schema.org for Google --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">itemprop</span>=<span class=\"string\">&quot;image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Open Graph --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;og:image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Twitter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;twitter:card&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;summary_large_image&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;twitter:image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>There are several meta tags for different purposes regarding images. For more information see the links at the end of this post. To make a long story short: The sum of these approaches ensures that when an article is posted, the corresponding image is also displayed in the social media post.</p>\n<p>But … it’s only the image, without a visual reference to the post itself. In this article I want to show you how to combine the photo with some meta information of the post automatically, to get a <strong>Social Media Image</strong>.</p>\n<p><img src=\"/post/Generate-Social-Media-Images-Automatically/generation-flow.png\" alt=\"Generation Flow\"></p>","categories":[{"name":"JavaScript","_id":"cljolajxz003ekrovfeyua029"}],"tags":[{"name":"Hexo","_id":"cljolajxx003bkrov85bb3iyv"},{"name":"GitHub","_id":"cljolajxz003dkrova6kfgs6k"},{"name":"Blogging","_id":"cljolajxz003fkrov0wvffula"},{"name":"Imaging","_id":"cljolajzd007gkrovb3eidsl2"},{"name":"ES6","_id":"cljolajzs008zkrov8vvzhune"}],"content":"<p>From day one of this blog I wanted to combine two of my passions: tech stuff and photography. All these photos I have shot myself in recent years and now they are representing my thoughts &amp; findings about digital technology. I wrote about my approach to provide these images in my post <a href=\"/post/Automatic-Header-Images-in-Hexo/\" title=\"Automatic Header Images in Hexo\">Automatic Header Images in Hexo</a>.</p>\n<p>When I share one of my posts on social media I provide the appropriate image as a visual anchor to my writing. The technique behind this are the <code>meta</code> tags in the HTML of my posts:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Schema.org for Google --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">itemprop</span>=<span class=\"string\">&quot;image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Open Graph --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;og:image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Twitter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;twitter:card&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;summary_large_image&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;twitter:image&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;https://kiko.io/photos/normal/DSC_6776.jpg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>There are several meta tags for different purposes regarding images. For more information see the links at the end of this post. To make a long story short: The sum of these approaches ensures that when an article is posted, the corresponding image is also displayed in the social media post.</p>\n<p>But … it’s only the image, without a visual reference to the post itself. In this article I want to show you how to combine the photo with some meta information of the post automatically, to get a <strong>Social Media Image</strong>.</p>\n<p><img src=\"/post/Generate-Social-Media-Images-Automatically/generation-flow.png\" alt=\"Generation Flow\"></p>\n<span id=\"more\"></span>\n\n<hr>\n<p>Starting point of my thoughts were two posts from <a href=\"https://24ways.org/2018/dynamic-social-sharing-images/\"><strong>Drew McLellan</strong> (Dynamic Social Sharing Images)</a> and <a href=\"https://www.ryanfiller.com/blog/automatic-social-share-images/\"><strong>Ryan Filler</strong> (Automatic Social Share Images)</a>, to which I have already referred in my post <a href=\"/post/Discoveries-11/\" title=\"Discoveries #11\">Discoveries #11</a>.</p>\n<p>Drew and Ryan utilizes the Node.JS library <a href=\"https://github.com/puppeteer/puppeteer\">Puppeteer</a>, which runs a headless Chromium (or Chrome browser) over the DevTools protocol to process a web page … for example to take a screenshot:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;puppeteer&#x27;</span>);</span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.<span class=\"title function_\">launch</span>();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.<span class=\"title function_\">newPage</span>();</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.<span class=\"title function_\">goto</span>(<span class=\"string\">&#x27;https://example.com&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.<span class=\"title function_\">screenshot</span>(&#123; <span class=\"attr\">path</span>: <span class=\"string\">&#x27;example.png&#x27;</span> &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.<span class=\"title function_\">close</span>();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<p>The idea is, to create a temporary HTML page with the photo and all necessary text for the social media image, take a screenshot of it and save it as PNG.</p>\n<p>As I run my blog with <a href=\"https://hexo.io/\">Hexo</a>, a Static Site Generator (SSG), all information about a post is defined in a <a href=\"https://en.wikipedia.org/wiki/Markdown\">Markdown</a> (MD) file with some <a href=\"https://hexo.io/docs/front-matter.html\">Frontmatter</a> for the meta information.</p>\n<p>Therefore, the <strong>Social Media Image Generator</strong> script in my mind had to do following tasks:</p>\n<ol>\n<li>Iterate recursively over all MD files in Hexo <code>_source/posts</code> folder</li>\n<li>Read the MD’s Frontmatter (for information about photo, title, subtitle and more)</li>\n<li>Create a temporary HTML file with the aid of a template</li>\n<li>Run Puppeteer script over the temporary file to take a screenshot</li>\n<li>Store the PNG to a central folder</li>\n<li>Optimize the PNG</li>\n<li>Change the meta tags in the posts to reference the new image</li>\n</ol>\n<hr>\n<h2 id=\"The-Frontmatter\"><a href=\"#The-Frontmatter\" class=\"headerlink\" title=\"The Frontmatter\"></a>The Frontmatter</h2><p>I pimped the Frontmatter of the original Hexo configuration a bit, in order to provide an individual photo for each post:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">Generate</span> <span class=\"string\">Social</span> <span class=\"string\">Media</span> <span class=\"string\">Images</span> <span class=\"string\">Automatically</span></span><br><span class=\"line\"><span class=\"attr\">subtitle:</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2021-07-10 11:07:31</span></span><br><span class=\"line\"><span class=\"attr\">photograph:</span></span><br><span class=\"line\">  <span class=\"attr\">file:</span> <span class=\"string\">DSC_6776.jpg</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">Color</span> <span class=\"string\">Brushes</span></span><br><span class=\"line\">  <span class=\"attr\">link:</span> <span class=\"string\">&#x27;https://500px.com/photo/79965349&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">categories:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">JavaScript</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n\n<p>Among other, there are the basic information, I wanted to have on my social media image: <code>photograph.file</code> (as the image itself) and <code>title</code>, <code>subtitle</code> and <code>categories</code> (for the text on the image).</p>\n<hr>\n<h2 id=\"The-Script\"><a href=\"#The-Script\" class=\"headerlink\" title=\"The Script\"></a>The Script</h2><p><strong>The complete script, in two versions (CommonJS and ES Module) is available at <a href=\"https://github.com/kristofzerbe/social-media-image-generator\">GitHub</a>.</strong></p>\n<p>tl;dr</p>\n<p>My script became a JavaScript <code>class</code>, separating the tasks in several methods and a constructor to get all necessary information as parameters. The class exports the main method <code>generate()</code> for calling the script:</p>\n<figure class=\"highlight js\"><figcaption><span>social-media-image-generator.cjs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> _currentPath = __dirname;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _postFolder;</span><br><span class=\"line\"><span class=\"keyword\">var</span> _photoFolder;</span><br><span class=\"line\"><span class=\"keyword\">var</span> _templateFile;</span><br><span class=\"line\"><span class=\"keyword\">var</span> _targetFolder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Generator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">postFolder, photoFolder, templateFile, targetFolder</span>) &#123; </span><br><span class=\"line\">    _postFolder = path.<span class=\"title function_\">join</span>(_currentPath, postFolder);</span><br><span class=\"line\">    _photoFolder = path.<span class=\"title function_\">join</span>(_currentPath, photoFolder);</span><br><span class=\"line\">    _templateFile = path.<span class=\"title function_\">join</span>(_currentPath, templateFile);</span><br><span class=\"line\">    _targetFolder = path.<span class=\"title function_\">join</span>(_currentPath, targetFolder);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">generate</span>(<span class=\"params\"></span>) &#123; ... &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getPostFiles</span>(<span class=\"params\">dirPath, allFiles</span>) &#123; ... &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"title function_\">processPost</span>(<span class=\"params\">fileName, vars</span>) &#123; ... &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"title function_\">createImage</span>(<span class=\"params\">fileName, tempFile</span>) &#123; ... &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span>.<span class=\"property\">Generator</span> = <span class=\"title class_\">Generator</span></span><br></pre></td></tr></table></figure>\n\n<p>I chose parameters, in order not to bind the script too tightly to my favourite SSG Hexo:</p>\n<ul>\n<li><code>_postFolder</code> - Where are the post files stored?</li>\n<li><code>_photoFolder</code> - Where are the photos stored?</li>\n<li><code>_templateFile</code> - Where is the template file for the temporary HTML stored?</li>\n<li><code>_targetFolder</code> - Where should the generated PNG files be stored?</li>\n</ul>\n<h3 id=\"Get-the-posts\"><a href=\"#Get-the-posts\" class=\"headerlink\" title=\"Get the posts\"></a>Get the posts</h3><p>First task was to get all MD files out of the <code>_postFolder</code> recursively:</p>\n<figure class=\"highlight js\"><figcaption><span>social-media-image-generator.cjs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Generator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">generate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> postFiles = <span class=\"variable language_\">this</span>.<span class=\"title function_\">getPostFiles</span>(_postFolder);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getPostFiles</span>(<span class=\"params\">dirPath, allFiles</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// READ FOLDER CONTENT</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> files = fs.<span class=\"title function_\">readdirSync</span>(dirPath);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//INIT TEMP ARRAY</span></span><br><span class=\"line\">      allFiles = allFiles || [];</span><br><span class=\"line\"></span><br><span class=\"line\">      files.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (fs.<span class=\"title function_\">statSync</span>(dirPath + <span class=\"string\">&quot;/&quot;</span> + file).<span class=\"title function_\">isDirectory</span>()) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// CALL THE METHOD RECURSIVELY</span></span><br><span class=\"line\">          allFiles = <span class=\"variable language_\">this</span>.<span class=\"title function_\">getPostFiles</span>(dirPath + <span class=\"string\">&quot;/&quot;</span> + file, allFiles)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (file.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;.md&quot;</span>)&gt;=<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// PUSH MD FILES TO TEMP ARRAY</span></span><br><span class=\"line\">          allFiles.<span class=\"title function_\">push</span>(path.<span class=\"title function_\">join</span>(dirPath, <span class=\"string\">&quot;/&quot;</span>, file))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> allFiles;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Get-the-template-and-the-temporary-folder\"><a href=\"#Get-the-template-and-the-temporary-folder\" class=\"headerlink\" title=\"Get the template and the temporary folder\"></a>Get the template and the temporary folder</h3><p>I chose <a href=\"https://handlebarsjs.com/\">Handlebars</a> as the template engine to generate the temporary HTML file, because it is so easy to handle.</p>\n<figure class=\"highlight html\"><figcaption><span>social-media-image.handlebars</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">      ...</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wrap&quot;</span>&gt;</span></span><br><span class=\"line\">      ...</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;photo&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;photo&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;#each categories&#125;&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">small</span>&gt;</span>&#123;&#123;this&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;/each&#125;&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;#if subtitle&#125;&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123;subtitle&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;/if&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>Handlebars is able to compile a template into a JavaScript variable, what makes it easy to reuse it. Good for performance and stability.</p>\n<p>As I wanted to utilize the template to generate temporary HTML files, I needed a temporary folder, which can be deleted afterwards.</p>\n<figure class=\"highlight js\"><figcaption><span>social-media-image-generator.cjs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> handlebars = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;handlebars&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _template;</span><br><span class=\"line\"><span class=\"keyword\">const</span> _tempFolder = <span class=\"string\">&quot;./~temp&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Generator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">postFolder, photoFolder, templateFile, targetFolder</span>) &#123; </span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// GET THE TEMPLATE CONTENT</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> source = fs.<span class=\"title function_\">readFileSync</span>(_templateFile).<span class=\"title function_\">toString</span>(<span class=\"string\">&#x27;utf8&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// COMPILE THE TEMPLATE FOR FURTHER USE ONCE</span></span><br><span class=\"line\">    _template = handlebars.<span class=\"title function_\">compile</span>(source);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// CREATE TEMP FOLDER IN THE WORKING DIRECTORY</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!fs.<span class=\"title function_\">existsSync</span>(_tempFolder)) &#123;</span><br><span class=\"line\">      fs.<span class=\"title function_\">mkdirSync</span>(_tempFolder);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Process-the-posts\"><a href=\"#Process-the-posts\" class=\"headerlink\" title=\"Process the posts\"></a>Process the posts</h3><p>Second step was to process all the posts found.</p>\n<figure class=\"highlight js\"><figcaption><span>social-media-image-generator.cjs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;url&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> frontmatter = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;front-matter&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> _tempFolder = <span class=\"string\">&quot;./~temp&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Generator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">generate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> self = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> postFiles = <span class=\"variable language_\">this</span>.<span class=\"title function_\">getPostFiles</span>(_postFolder);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">var</span> postsProcessed = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// ITERATE OVER ALL POSTS</span></span><br><span class=\"line\">      postFiles.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        fs.<span class=\"title function_\">readFile</span>(file, <span class=\"string\">&#x27;utf8&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// READ THE FRONTMATTER</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> content = <span class=\"title function_\">frontmatter</span>(data);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">let</span> fileName = path.<span class=\"title function_\">basename</span>(file, path.<span class=\"title function_\">extname</span>(file));</span><br><span class=\"line\">      </span><br><span class=\"line\">          <span class=\"comment\">// only process posts with defined photograph file </span></span><br><span class=\"line\">          <span class=\"comment\">// and if social media file is missing</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (content.<span class=\"property\">attributes</span>.<span class=\"property\">photograph</span>?.<span class=\"property\">file</span> &amp;&amp; </span><br><span class=\"line\">              !fs.<span class=\"title function_\">existsSync</span>(path.<span class=\"title function_\">join</span>(_targetFolder, fileName + <span class=\"string\">&quot;.png&quot;</span>))) &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// CALL PROCESSING METHOD</span></span><br><span class=\"line\">            self.<span class=\"title function_\">processPost</span>(</span><br><span class=\"line\">              fileName,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                <span class=\"attr\">title</span>: content.<span class=\"property\">attributes</span>.<span class=\"property\">title</span>, </span><br><span class=\"line\">                <span class=\"attr\">subtitle</span>: content.<span class=\"property\">attributes</span>.<span class=\"property\">subtitle</span>, </span><br><span class=\"line\">                <span class=\"attr\">categories</span>: content.<span class=\"property\">attributes</span>.<span class=\"property\">categories</span>,</span><br><span class=\"line\">                <span class=\"attr\">photo</span>: url.<span class=\"title function_\">pathToFileURL</span>(</span><br><span class=\"line\">                  path.<span class=\"title function_\">join</span>(_photoFolder, content.<span class=\"property\">attributes</span>.<span class=\"property\">photograph</span>.<span class=\"property\">file</span>)</span><br><span class=\"line\">                )</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">              .<span class=\"title function_\">then</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// DELETE TEMP FOLDER AFTER PROCESSING</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (postsProcessed === postFiles.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">                  fs.<span class=\"title function_\">rmdirSync</span>(_tempFolder, &#123; <span class=\"attr\">recursive</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          postsProcessed += <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"title function_\">processPost</span>(<span class=\"params\">fileName, vars</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// GET HTML FOR POST VIA HANDLEBARS</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> html = <span class=\"title function_\">_template</span>(vars);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> tempFile = path.<span class=\"title function_\">join</span>(_tempFolder, fileName + <span class=\"string\">&quot;.html&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//WRITE TEMPORARY HTML FILE</span></span><br><span class=\"line\">      fs.<span class=\"title function_\">writeFile</span>(tempFile, html, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(err) &#123; <span class=\"keyword\">throw</span>(err); &#125;</span><br><span class=\"line\">        <span class=\"comment\">//console.log(tempFile + &quot; saved&quot;);</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//CALL IMAGING METHOD</span></span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">createImage</span>(fileName, tempFile);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Get-the-image\"><a href=\"#Get-the-image\" class=\"headerlink\" title=\"Get the image\"></a>Get the image</h3><p>As I had the temporary HTML file now, I only had to open up a Puppeteer instance, load the file and take the screenshot:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;puppeteer/cjs-entry&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> imagemin = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;imagemin&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> imageminPngquant = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;imagemin-pngquant&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Generator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"title function_\">createImage</span>(<span class=\"params\">fileName, tempFile</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// LAUNCH CHROMIUM AND A NEW PAGE</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.<span class=\"title function_\">launch</span>();</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.<span class=\"title function_\">newPage</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// LOAD THE TEMPORARY HTML FILE</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.<span class=\"title function_\">goto</span>(url.<span class=\"title function_\">pathToFileURL</span>(tempFile));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// SET THE EXACT WIDTH &amp; HEIGHT</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.<span class=\"title function_\">setViewport</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">1200</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">630</span>,</span><br><span class=\"line\">      <span class=\"attr\">deviceScaleFactor</span>: <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> imgFile = path.<span class=\"title function_\">join</span>(_targetFolder, fileName + <span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// TAKE SCREENSHOT INTO PNG FILE AT TARGET FOLDER</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.<span class=\"title function_\">screenshot</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">path</span>: imgFile</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.<span class=\"title function_\">close</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// OPTIMIZE THE PNG FILE</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">imagemin</span>([imgFile], <span class=\"string\">&#x27;build&#x27;</span>, &#123;</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"title function_\">imageminPngquant</span>(&#123; <span class=\"attr\">quality</span>: <span class=\"string\">&#x27;75-90&#x27;</span> &#125;)</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Running-the-script\"><a href=\"#Running-the-script\" class=\"headerlink\" title=\"Running the script\"></a>Running the script</h2><p>If you already have lots of post in MD files and appropriate photographs, you can create an execution script…</p>\n<figure class=\"highlight js\"><figcaption><span>run-social-media-images.cjs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Generator</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./social-media-image-generator.cjs&quot;</span>).<span class=\"property\">Generator</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> postFolder = process.<span class=\"property\">argv</span>[<span class=\"number\">2</span>].<span class=\"title function_\">toString</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> photoFolder = process.<span class=\"property\">argv</span>[<span class=\"number\">3</span>].<span class=\"title function_\">toString</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> templateFile = process.<span class=\"property\">argv</span>[<span class=\"number\">4</span>].<span class=\"title function_\">toString</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> targetFolder = process.<span class=\"property\">argv</span>[<span class=\"number\">5</span>].<span class=\"title function_\">toString</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> generator = <span class=\"keyword\">new</span> <span class=\"title class_\">Generator</span>(postFolder, photoFolder, templateFile, targetFolder);</span><br><span class=\"line\">generator.<span class=\"title function_\">generate</span>();</span><br></pre></td></tr></table></figure>\n\n<p>… and run it as follows:</p>\n<figure class=\"highlight js\"><figcaption><span>Example execution in the console...</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node <span class=\"string\">&quot;./lib/run-social-media-images.cjs&quot;</span> <span class=\"string\">&quot;../source/_posts&quot;</span> <span class=\"string\">&quot;../static/photos/normal&quot;</span> <span class=\"string\">&quot;../templates/social-media-image.handlebars&quot;</span> <span class=\"string\">&quot;../static/images/social-media&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Hexo-Integration\"><a href=\"#Hexo-Integration\" class=\"headerlink\" title=\"Hexo Integration\"></a>Hexo Integration</h2><p>In case you are running your blog with Hexo also, you can hook on the <code>ready</code> event to let it run on <code>hexo generate</code> automatically:</p>\n<figure class=\"highlight js\"><figcaption><span>/scripts/on-ready-generate-social-media-images.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> log = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-log&#x27;</span>)(&#123;</span><br><span class=\"line\">    <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">silent</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Generator</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../lib/social-media-image-generator.cjs&quot;</span>).<span class=\"property\">Generator</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">hexo.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;ready&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    log.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;Running Social-Media-Image-Generator...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> postFolder = <span class=\"string\">&quot;../source/_posts&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> photoFolder = <span class=\"string\">&quot;../static/photos/normal&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> templateFile = <span class=\"string\">&quot;../templates/social-media-image.handlebars&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> targetFolder = <span class=\"string\">&quot;../static/images/social-media&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> generator = <span class=\"keyword\">new</span> <span class=\"title class_\">Generator</span>(postFolder, photoFolder, templateFile, targetFolder);</span><br><span class=\"line\">    generator.<span class=\"title function_\">generate</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>It is important not to store the <code>social-media-image-generator.cjs</code> in Hexo’s <code>scripts</code> folder like the event script above, because Hexo will try to execute it automatically. You have to create a different folder like <code>lib</code> to store and reference it from there.</p>\n<hr>\n<h2 id=\"The-Result\"><a href=\"#The-Result\" class=\"headerlink\" title=\"The Result\"></a>The Result</h2><p>Here is the result from my approach in Hexo, as I run <code>hexo generate</code> for this blog post:</p>\n<img src=\"/images/social-media/Generate-Social-Media-Images-Automatically.png\" />\n\n<p>The very last thing I had to do, was to change the source of the image meta tag mentioned at the top, to reference to newly created social media image.</p>\n<p>Here’s the new image in action at Twitter:</p>\n<p><img src=\"/post/Generate-Social-Media-Images-Automatically/twitter.png\" alt=\"Tweet Preview\"></p>\n<hr>\n<h2 id=\"More-Info\"><a href=\"#More-Info\" class=\"headerlink\" title=\"More Info\"></a>More Info</h2>\n        <ul class=\"moreinfo-list\">\n            <li>CSS Tricks: <a href=\"https://css-tricks.com/essential-meta-tags-social-media/\">The Essential Meta Tags for Social Media</a></li><li>The Open Graph Protocol: <a href=\"https://opengraphprotocol.org/\">The Open Graph Protocol</a></li><li>Drew McLellan: <a href=\"https://24ways.org/2018/dynamic-social-sharing-images/\">Dynamic Social Sharing Images</a></li><li>Ryan Filler: <a href=\"https://www.ryanfiller.com/blog/automatic-social-share-images/\">Automatic Social Share Images</a></li><li>The GitHub Blog: <a href=\"https://github.blog/2021-06-22-framework-building-open-graph-images/\">A framework for building Open Graph images</a></li>\n        </ul>\n    ","_path":"post/Generate-Social-Media-Images-Automatically/","_link":"https://kiko.io/post/Generate-Social-Media-Images-Automatically/","_id":"cljolajw7001fkrovf7wzem13"}}