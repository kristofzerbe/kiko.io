{"type":"getPostByPath","data":{"title":"Include and provide JSON data in Hexo EJS Templates","date":"2023-06-27T05:26:21.000Z","description":"<p>The three main components of a standard installation of the Static Site Generator <a href=\"https://hexo.io/\">Hexo</a> are the template system <a href=\"https://ejs.co/\">EJS (Embedded JavaScript Templating)</a>, <a href=\"https://en.wikipedia.org/wiki/Markdown\">Markdown</a> for the content and <a href=\"https://stylus-lang.com/\">Stylus</a> for the styles.</p>\n<p>In the template files are the three main tags for driving content:</p>\n<p><strong>Scriptlet tag for control flow (no output)</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%</span><br><span class=\"line\">  ... my JavaScript code to process data into the template</span><br><span class=\"line\">%&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Output a value as escaped HTML</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%= myVariable %&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Output of a raw value, usually in the form of a JavaScript function</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- myFunction() %&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://hexo.io/docs/helpers\">Hexo’s helper system</a> is based on the latter. So you can include a JavaScript file in your template that makes use of the <a href=\"https://hexo.io/docs/helpers#js\"><strong>JS Helper</strong></a> in <code>node_modules\\hexo\\lib\\plugins\\helper\\js.js</code> as follows …</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;/js/dist/myFancyFunctions.js&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>\n\n<p>… which will be rendered to:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/js/dist//js/dist/qr-code-styling.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"The-Problem\"><a href=\"#The-Problem\" class=\"headerlink\" title=\"The Problem\"></a>The Problem</h2><p>So far and short, so good … but I recently tried to use this way to include a JSON file whose data one of my scripts needed as startup options and I noticed that the above mentioned JS helper unfortunately takes care of the possibly missing file extension <code>js</code>. It doesn’t matter if you only pass the path to the file as a string or if all necessary attributes as an object.</p>","categories":[{"name":"JavaScript","_id":"clli72sfu003ijynp4lra7r5i"}],"tags":[{"name":"Hexo","_id":"clli72sfs003fjynp85gmgis4"},{"name":"Templating","_id":"clli72shs009zjynpggm2bic5"}],"content":"<p>The three main components of a standard installation of the Static Site Generator <a href=\"https://hexo.io/\">Hexo</a> are the template system <a href=\"https://ejs.co/\">EJS (Embedded JavaScript Templating)</a>, <a href=\"https://en.wikipedia.org/wiki/Markdown\">Markdown</a> for the content and <a href=\"https://stylus-lang.com/\">Stylus</a> for the styles.</p>\n<p>In the template files are the three main tags for driving content:</p>\n<p><strong>Scriptlet tag for control flow (no output)</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%</span><br><span class=\"line\">  ... my JavaScript code to process data into the template</span><br><span class=\"line\">%&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Output a value as escaped HTML</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%= myVariable %&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Output of a raw value, usually in the form of a JavaScript function</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- myFunction() %&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://hexo.io/docs/helpers\">Hexo’s helper system</a> is based on the latter. So you can include a JavaScript file in your template that makes use of the <a href=\"https://hexo.io/docs/helpers#js\"><strong>JS Helper</strong></a> in <code>node_modules\\hexo\\lib\\plugins\\helper\\js.js</code> as follows …</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;/js/dist/myFancyFunctions.js&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>\n\n<p>… which will be rendered to:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/js/dist//js/dist/qr-code-styling.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"The-Problem\"><a href=\"#The-Problem\" class=\"headerlink\" title=\"The Problem\"></a>The Problem</h2><p>So far and short, so good … but I recently tried to use this way to include a JSON file whose data one of my scripts needed as startup options and I noticed that the above mentioned JS helper unfortunately takes care of the possibly missing file extension <code>js</code>. It doesn’t matter if you only pass the path to the file as a string or if all necessary attributes as an object.</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">src</span>: <span class=\"string\">&#x27;js/dist/script-options.json&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">&#125;) %&gt;</span><br></pre></td></tr></table></figure>\n\n<p>This code leads to the following wrong code …</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/js/dist//js/dist/qr-code-styling.json.js&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">type</span>=<span class=\"string\">&quot;application/json&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"The-JSON-Helper\"><a href=\"#The-JSON-Helper\" class=\"headerlink\" title=\"The JSON Helper\"></a>The JSON Helper</h2><p>Since Hexo’s developers went a bit over my&#x2F;the target with the helper’s functionality, I had to build my own JSON helper, which is actually just a slightly customized copy of the original:</p>\n<figure class=\"highlight js\"><figcaption><span>themes\\landscape\\scripts\\json-helper.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; htmlTag, url_for &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-util&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">helper</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;json&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">...args</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  args.<span class=\"title function_\">flat</span>(<span class=\"title class_\">Infinity</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> item === <span class=\"string\">&#x27;string&#x27;</span> || item <span class=\"keyword\">instanceof</span> <span class=\"title class_\">String</span>) &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// args = String only</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> path = item;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!path.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;.json&#x27;</span>)) &#123;</span><br><span class=\"line\">        path += <span class=\"string\">&#x27;.json&#x27;</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      result += <span class=\"string\">`&lt;script src=&quot;<span class=\"subst\">$&#123;url_for.call(<span class=\"variable language_\">this</span>, path)&#125;</span>&quot; type=&quot;application/json&quot;&gt;&lt;/script&gt;\\n`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// args = Object -&gt; Custom Attributes</span></span><br><span class=\"line\">      item.<span class=\"property\">src</span> = url_for.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, item.<span class=\"property\">src</span>);</span><br><span class=\"line\">      item.<span class=\"property\">type</span> = <span class=\"string\">&quot;application/json&quot;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!item.<span class=\"property\">src</span>.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;.json&#x27;</span>)) item.<span class=\"property\">src</span> += <span class=\"string\">&#x27;.json&#x27;</span>;</span><br><span class=\"line\">      result += <span class=\"title function_\">htmlTag</span>(<span class=\"string\">&#x27;script&#x27;</span>, &#123; ...item &#125;, <span class=\"string\">&#x27;&#x27;</span>) + <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>You can find the complete file <a href=\"https://github.com/kristofzerbe/kiko.io/blob/master/themes/landscape/scripts/json-helper.js\">here</a>.</p>\n<p>With this its possible to reference the JSON like this:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">json</span>(<span class=\"string\">&#x27;js/dist/myOptions.json&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"Bring-JSON-data-to-life\"><a href=\"#Bring-JSON-data-to-life\" class=\"headerlink\" title=\"Bring JSON data to life\"></a>Bring JSON data to life</h2><p>However, the helper only allowed me to load the file as such. What was still missing was the loading of the data in the JavaScript of the page itself. The easiest way to achieve that, was to perform a FETCH of the already referenced and loaded file in the SCRIPT block of the template as an immediately invoked async function:</p>\n<figure class=\"highlight html\"><figcaption><span>EJS File</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- js(&#x27;js/dist/myFancyObjectLibrary.js&#x27;) %&gt;</span><br><span class=\"line\">&lt;%- json(&#123;</span><br><span class=\"line\">  src: &#x27;js/dist/myOptions.json&#x27;, </span><br><span class=\"line\">  id: &#x27;my-options&#x27;</span><br><span class=\"line\">&#125;) %&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"> (<span class=\"keyword\">async</span> () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;my-options&#x27;</span>).<span class=\"property\">src</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> options = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>();    </span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">let</span> obj = <span class=\"keyword\">new</span> <span class=\"title function_\">myFancyObject</span>(options);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">//... do something with the initialized object</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Et voilà … Job done.</p>\n","_path":"post/Include-and-provide-JSON-data-in-Hexo-EJS-Templates/","_link":"https://kiko.io/post/Include-and-provide-JSON-data-in-Hexo-EJS-Templates/","_id":"clli72sep0032jynpaere2smc"}}