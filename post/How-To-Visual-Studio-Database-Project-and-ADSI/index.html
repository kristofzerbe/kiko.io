<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title data-area="POST">How-To: Visual Studio Database Project and ADSI - kiko.io</title>
  <meta name="author" content="Kristof Zerbe">
  <meta name="title" content="How-To: Visual Studio Database Project and ADSI - kiko.io">
  
  <meta name="description" content="If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announc...">
  
   
  <meta name="excerpt" content="If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announce the data structure of the AD data in order to get the project compiled.">
  
  
  <link rel="canonical" href="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <meta name="theme-color" content="#444">

    
  <script type="application/ld+json">{"@context":"http://schema.org/","@graph":[{"@type":"Article","@id":"https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/#article","mainEntityOfPage":{"@id":"https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/"},"headline":"How-To: Visual Studio Database Project and ADSI - kiko.io","description":"If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announc...","datePublished":"2019-09-17T10:00:01Z","dateModified":"2019-09-17T10:00:01Z","image":{"@id":"https://kiko.io#image/How-To-Visual-Studio-Database-Project-and-ADSI"},"author":{"@id":"https://kiko.io/#person"},"publisher":{"@id":"https://kiko.io/#organization"}},{"@type":"WebPage","@id":"https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/","url":"https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/","name":"How-To: Visual Studio Database Project and ADSI - kiko.io","isPartOf":{"@id":"https://kiko.io/#website"},"description":"If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announc...","inLanguage":"en-US","primaryImageOfPage":{"@id":"https://kiko.io#image/How-To-Visual-Studio-Database-Project-and-ADSI"},"image":{"@id":"https://kiko.io#photo/19-05 Israel-0516.jpg"}},{"@type":"WebSite","@id":"https://kiko.io/#website","url":"https://kiko.io","name":"kiko.io","description":"Blog about memorable tech stuff by Kristof Zerbe","inLanguage":"en-US","publisher":{"@id":"https://kiko.io/#organization"},"potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://kiko.io/search/?q={searchTerm}"},"query-input":"required name=searchTerm"}},{"@type":"Organization","@id":"https://kiko.io/#organization","name":"kiko.io","url":"https://kiko.io","logo":"https://kiko.io/images/icon-192x192.png"},{"@type":"Person","@id":"https://kiko.io/#person","name":"Kristof Zerbe","url":"https://kiko.io/about","image":"https://kiko.io/images/kristof-zerbe.png","sameAs":["https://github.com/kristofzerbe","https://www.xing.com/profile/Kristof_Zerbe","https://www.linkedin.com/in/kristof-zerbe-91012510/","https://500px.com/p/kikon","https://indieweb.social/@kiko","https://pixelfed.social/kristofz"]},{"@type":"ImageObject","@id":"https://kiko.io#photo/19-05 Israel-0516.jpg","caption":"Jaffa Accessoirs","url":"https://kiko.io/photos/normal/19-05 Israel-0516.jpg","contentUrl":"https://kiko.io/photos/normal/19-05 Israel-0516.jpg","discussionUrl":"https://kiko.io/photos/19-05 Israel-0516","license":"https://creativecommons.org/licenses/by-sa/4.0/","acquireLicensePage":"https://kiko.io/photos","creditText":"Kristof Zerbe","copyrightNotice":"Kristof Zerbe (CC BY-SA 4.0)","creator":{"@id":"https://kiko.io/#person"}},{"@type":"ImageObject","@id":"https://kiko.io#image/How-To-Visual-Studio-Database-Project-and-ADSI","url":"/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png","contentUrl":"/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png","license":"https://creativecommons.org/licenses/by-sa/4.0/","acquireLicensePage":"https://kiko.io/photos","creditText":"Kristof Zerbe","copyrightNotice":"Kristof Zerbe (CC BY-SA 4.0)","creator":{"@id":"https://kiko.io/#person"}}]}</script>

    <meta property="og:site_name" content="kiko.io">
  <meta property="og:type" content="blog">
  <meta property="og:url" content="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/">
  <meta property="og:title" content="How-To: Visual Studio Database Project and ADSI - kiko.io">
  
  <meta property="og:description" content="If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announc...">
  
  <meta property="og:image" content="https://kiko.io/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/">
  <meta property="twitter:title" content="How-To: Visual Studio Database Project and ADSI - kiko.io">
  
  <meta property="twitter:description" content="If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announc...">
  
  <meta property="twitter:image" content="https://kiko.io/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png">

    <link rel="webmention" href="https://webmention.io/kiko.io/webmention" />
  <link rel="pingback" href="https://webmention.io/kiko.io/xmlrpc" />

    <link rel="authorization_endpoint" href="https://indieauth.com/auth" />
  <link rel="token_endpoint" href="https://tokens.indieauth.com/token" />
  <link href="https://github.com/kristofzerbe" rel="me authn">
  <link href="mailto:kristof.zerbe@gmail.com" rel="me authn">
  
    <link rel="alternate" href="/atom.xml" title="How-To: Visual Studio Database Project and ADSI - kiko.io" type="application/atom+xml">

  <link rel="preload" href="/css/fonts/lexend/webfonts/Lexend-ExtraLight.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/lexend/webfonts/Lexend-Light.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/lexend/webfonts/Lexend-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/lexend/webfonts/Lexend-Medium.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/lexend/webfonts/Lexend-SemiBold.woff2" as="font" type="font/woff2" crossorigin>
  
  <link rel="preload" href="/css/fonts/opensans/opensans-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/opensans/opensans-italic.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/opensans/opensans-semibold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/opensans/opensans-semibolditalic.woff2" as="font" type="font/woff2" crossorigin>
  
  <link rel="preload" href="/css/fonts/sourcecodepro/WOFF2/TTF/SourceCodePro-Regular.ttf.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/sourcecodepro/WOFF2/TTF/SourceCodePro-It.ttf.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/sourcecodepro/WOFF2/TTF/SourceCodePro-Bold.ttf.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/css/fonts/sourcecodepro/WOFF2/TTF/SourceCodePro-BoldIt.ttf.woff2" as="font" type="font/woff2" crossorigin>
  
  <link rel="preload" href="/css/fonts/forkawesome/forkawesome-webfont.woff2" as="font" type="font/woff2" crossorigin>

  
  <link rel="preload" as="image" id="img-preload" href="/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png" 
        imagesrcset="/images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png 480w, /images/social-media/How-To-Visual-Studio-Database-Project-and-ADSI.png 768w">
  <link rel="preload" as="image" id="photo-preload" href="/photos/normal/19-05 Israel-0516.jpg" 
        imagesrcset="/photos/mobile/19-05 Israel-0516.jpg 480w, /photos/tablet/19-05 Israel-0516.jpg 768w">
  
    
  
<link rel="stylesheet" href="/css/dist/asset-bundle.min.css">

  
<link rel="stylesheet" href="/css/style.css">


  <script>
    var theme = "light"; //default

    var storedTheme = localStorage.getItem("theme"); 
    if (storedTheme) { 
      theme = storedTheme; 
    } else if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
      theme = "dark";
    }

    localStorage.setItem("theme", theme);
    document.documentElement.setAttribute("data-theme", theme);

    window.onload = function () { setTheme(theme); };

  </script>

  
<script src="/js/tools.js"></script>

  
<script src="/js/dialog.js"></script>

  
<script src="/js/dist/scroll-timeline.js"></script>

  
<script src="/js/dist/tiny-slider.js"></script>

  
<script src="/js/dist/image-compare-viewer.min.js"></script>

  
<script src="/js/dist/macy.js"></script>



  <script defer type="text/javascript" 
    src="https://api.pirsch.io/pirsch.js"
    id="pirschjs"
    data-code="aJ835msd85Jl5WkTLtS76XLxVxSm4ODZ"></script>
  <script type="text/javascript" 
    src="https://api.pirsch.io/pirsch-events.js"
    id="pirscheventsjs"
    data-code="aJ835msd85Jl5WkTLtS76XLxVxSm4ODZ"></script>    


<meta name="generator" content="Hexo 6.3.0"></head>

<body id="body">  
  <header id="header">
  <a href="#" id="header-photo-link" rel="noopener" ></a>
  <div id="banner">
    <div id="header-nav-start"></div>
    <nav id="header-nav" role="navigation">
      <ul class="menu">
        
          
          <li class="menu-item menu-item-icon" id="nav-home-link">
            <a class="sub-nav-link"
               href="/">
                <span>Home</span>
              </a>
          </li>
        
          
          <li class="menu-item menu-item-icon" id="nav-search-link">
            <a class="sub-nav-link"
               href="/search">
                <span>Search</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-archives-link">
            <a class="sub-nav-link"
               href="/archives">
                <span>Archives</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-series-link">
            <a class="sub-nav-link"
               href="/series">
                <span>series</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-notes-link">
            <a class="sub-nav-link"
               href="/notes">
                <span>notes</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-photos-link">
            <a class="sub-nav-link"
               href="/photos">
                <span>photos</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-tiny-tools-link">
            <a class="sub-nav-link"
               href="/collections/tiny-tools">
                <span>tiny-tools</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-projects-link">
            <a class="sub-nav-link"
               href="/projects">
                <span>projects</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-about-link">
            <a class="sub-nav-link"
               href="/about">
                <span>About</span>
              </a>
          </li>
        
          
          <li class="menu-item" id="nav-feeds-link">
            <a class="sub-nav-link"
               href="/feeds">
                <span>Feeds</span>
              </a>
          </li>
        
      </ul>
    </nav>
    <div id="header-nav-end"></div>
  </div>
  <div id="progress"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
        <a href="/" id="logo">
          <h1 id="title-wrap">
            <span style="opacity:0.2;">kiko.io</span>
          </h1>
        </a>
      
        <h2 id="subtitle">
          Memorable Tech Stuff
        </h2>
        <div id="sub-socialmediaimage-link" onclick="copysocialmediaimageLink();"></div>
        <script>
          function copysocialmediaimageLink() {
            let smil = document.querySelector('meta[property="og:image"]').content;
            copyTextToClipboard(smil);
          }
        </script>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        <div id="sub-nav-theme">          
          <input type="checkbox" id="theme-switch">
          <label for="theme-switch"></label>
        </div>
      </nav>
    </div>
  </div>
</header>
<script>
  if (location.pathname === "/") {
    document.getElementById("nav-home-link").remove();
  }
</script>
  <div id="content" class="outer">
    <main class="">
  <style>
#banner {
    background-size: cover;
}
@media screen and (max-width: 479px) {
    #banner { background-image: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 75%), url("/photos/mobile/19-05 Israel-0516.jpg"); }
}
@media screen and (min-width: 480px) and (max-width: 767px) {
    #banner { background-image: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 75%), url("/photos/tablet/19-05 Israel-0516.jpg"); }
}
@media screen and (min-width: 768px) {
    #banner { background-image: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 75%), url("/photos/normal/19-05 Israel-0516.jpg"); }    
}
</style>

<img id="header-photo" data-pagefind-meta="image[src], image_alt[alt]"
     src="/photos/normal/19-05 Israel-0516.jpg" 
     alt="Jaffa Accessoirs"
     width="0" height="0"/>


    <script>
        var header = document.getElementById("header");
        header.classList.add("photograph");
        
        var photoLink = document.getElementById("header-photo-link");
        photoLink.href = "/photos/19-05 Israel-0516";
        photoLink.innerHTML = "<strong>Jaffa Accessoirs</strong>";
    </script>




<script>
  var body = document.getElementById("body");
  body.classList.add("article-view");
</script>
  
<article id="post-2019/How-To-Visual-Studio-Database-Project-and-ADSI" data-pagefind-body data-pagefind-meta="type:Article"
         class="article article-type-post h-entry">
  
  <div class="article-meta" data-pagefind-ignore>
    <div class="h-card p-author" style="display:none">
      <img class="u-photo" src="/images/kristof-zerbe.png" alt="Kristof Zerbe" />
      <a class="p-name u-url" href="https://kiko.io" rel="author">Kristof Zerbe</a>
    </div>
    <a class="u-url u-uid" href="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/" style="display:none;">https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/</a>
    <a href="/post/How-To-Visual-Studio-Database-Project-and-ADSI/" class="article-date">
  
  <time class="published dt-published" data-pagefind-meta="date" 
        datetime="2019-09-17T10:00:01.000Z">17 Sep 2019</time>
</a>
    
  <div class="article-category p-category category-sql">
    <a class="article-category-link" href="/categories/SQL/">SQL</a> 
  </div>

  </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        




        


  
    <h1 class="article-title p-name" data-pagefind-ignore
        data-title="How-To: Visual Studio Database Project and ADSI" 
        data-pagefind-meta="title[data-title]">
        
        <span>How-To: Visual Studio Database Project and ADSI</span>
    </h1>
  

        
      </header>
    
    
    <div class="article-entry e-content">
      <p>If you are working with a Visual Studio Database Project and have to deal with data from the Active Directory via a Linked Server, you have to announce the data structure of the AD data in order to get the project compiled.</p>
<span id="more"></span>
<h2 id="Step-1-Linking-to-the-Active-Directory"><a href="#Step-1-Linking-to-the-Active-Directory" class="headerlink" title="Step 1 - Linking to the Active Directory"></a>Step 1 - Linking to the Active Directory</h2><p>First of all you have to connect your SQL Server to the AD permanently, by running  following SQL script once on your SQL Server:</p>
<pre><code>USE [master]
GO
EXEC master.dbo.sp_addlinkedserver @server = N&#39;ADSI&#39;, 
    @srvproduct=N&#39;Active Directory Service Interfaces&#39;, 
    @provider=N&#39;ADSDSOObject&#39;, 
    @datasrc=N&#39;adsdatasource&#39;

EXEC master.dbo.sp_addlinkedsrvlogin @rmtsrvname=N&#39;ADSI&#39;,
    @useself=N&#39;False&#39;,
    @locallogin=NULL,
    @rmtuser=N&#39;mydomain\myadminuser&#39;,
    @rmtpassword=&#39;mypassword&#39;
GO

EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;collation compatible&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;data access&#39;, @optvalue=N&#39;true&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;dist&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;pub&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;rpc&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;rpc out&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;sub&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;connect timeout&#39;, @optvalue=N&#39;0&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;collation name&#39;, @optvalue=null
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;lazy schema validation&#39;, @optvalue=N&#39;false&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;query timeout&#39;, @optvalue=N&#39;0&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;use remote collation&#39;, @optvalue=N&#39;true&#39;
GO
EXEC master.dbo.sp_serveroption @server=N&#39;ADSI&#39;, 
    @optname=N&#39;remote proc transaction promotion&#39;, @optvalue=N&#39;true&#39;
GO
</code></pre>
<h2 id="Step-2-Fetching-ADSI-data"><a href="#Step-2-Fetching-ADSI-data" class="headerlink" title="Step 2 - Fetching ADSI data"></a>Step 2 - Fetching ADSI data</h2><p>To get data, use <code>OpenQuery</code> against the Linked Server. In order to get only persons and no system accounts, you should filter out all users, which has no firstname (<code>givenName</code>) or lastname (<code>sn</code>):</p>
<pre><code>SELECT 
    UserPrincipalName, 
    DisplayName, 
    sAMAccountName AS [SamAccountName], 
    sn AS [LastName], 
    givenName AS [FirstName], 
    title AS [Title], 
    Mail as [MailAddress],
    department AS [Department],
    l AS [Location], 
    postalCode AS [PostCode], 
    streetAddress AS [Street],
    st AS [State]
FROM OpenQuery(ADSI, &#39;
    SELECT 
        UserPrincipalName, 
        DisplayName, 
        sAMAccountName, 
        sn, 
        givenName, 
        department,
        title, 
        Mail, 
        l, 
        postalCode, 
        streetAddress, 
        st
    FROM &#39;&#39;LDAP://mydomain.de/DC=mydomain,DC=de&#39;&#39; 
    WHERE objectClass =  &#39;&#39;User&#39;&#39; 
    AND objectCategory = &#39;&#39;Person&#39;&#39; 
    AND sn=&#39;&#39;*&#39;&#39; 
    AND givenName = &#39;&#39;*&#39;&#39; 
&#39;)    
</code></pre>
<p>In most cases you’re done with that … except your organisation has more the 900 users! Then you have to split the fetch in several requests, because SQL Server quits with an error, when trying to read more than 900 records via ADSI.  </p>
<p>Best option is, to filter the ADSI statement by something like <em>‘get all user starting with a to j’</em>, when you are sure, that in this case less than 900 records will be given back and repeat the statement several times and glue the data together via a <code>UNION</code> statement:</p>
<pre>
<code>SELECT  
    UserPrincipalName,  
    DisplayName,  
    sAMAccountName AS [SamAccountName],  
    sn AS [LastName],  
    givenName AS [FirstName],  
    title AS [Title],  
    Mail as [MailAddress],  
    department AS [Department],  
    l AS [Location],  
    postalCode AS [PostCode],  
    streetAddress AS [Street],  
    st AS [State]  
FROM (  
    SELECT *  
    FROM OpenQuery(ADSI, '  
        SELECT  
            UserPrincipalName,  
            DisplayName,  
            sAMAccountName,  
            sn,  
            givenName,  
            department,  
            title,  
            Mail,  
            l,  
            postalCode,  
            streetAddress,  
            st  
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''  
        WHERE objectClass =  ''User''  
        AND objectCategory = ''Person''  
        AND sn=''*''  
        AND givenName = ''*''  
        <strong>AND sAMAccountName &lt;= ''j''</strong>
    ')  

    <strong>UNION ALL</strong>  

    SELECT *  
    FROM OpenQuery(ADSI, '  
        SELECT <em>[...same as above]</em>  
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''  
        WHERE objectClass =  ''User''  
        AND objectCategory = ''Person''  
        AND sn=''*''  
        AND givenName = ''*''  
        <strong>AND sAMAccountName &gt; ''j''</strong>  
        <strong>AND sAMAccountName &lt; ''p''</strong>  
    ')

    <strong>UNION ALL</strong>  

    SELECT *  
    FROM OpenQuery(ADSI,  '  
        SELECT <em>[...same as above]</em>  
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''  
        WHERE objectClass =  ''User''  
        AND objectCategory = ''Person''  
        AND sn=''*'' AND givenName = ''*''  
        <strong>AND sAMAccountName &gt;= ''p''</strong>  
    ')  
) AD</code>
</pre>

<p>When you store this as a VIEW, you can join it wherever you want on SQL Server:</p>
<pre>
<code>CREATE VIEW [dbo].[vADUsers]
AS
    <em>[...SQL code from above]</em>

GO</code>
</pre>

<h2 id="Step-3-SQL-Server-Database-Project"><a href="#Step-3-SQL-Server-Database-Project" class="headerlink" title="Step 3 - SQL Server Database Project"></a>Step 3 - SQL Server Database Project</h2><p>If you work with a SQL Server Database Project, to have the complete structure of your database available in a version control system, you will get some reference errors on compiling and publishing your newly added SQL View <code>vADUsers</code> and on some objects, which rely on this View, because of following problems:</p>
<ol>
<li>Project doesn’t know the Linked Server <code>ADSI</code></li>
<li>The structure (fields) of the data source is unknown</li>
</ol>
<h3 id="Declare-the-Linked-Server"><a href="#Declare-the-Linked-Server" class="headerlink" title="Declare the Linked Server"></a>Declare the Linked Server</h3><p>To show the Project that there is a Linked Server called <code>ADSI</code>, just add following lines at the start of your view:</p>
<pre>
<code><strong>sp_addlinkedserver 'ADSI'</strong>
<strong>GO</strong>

CREATE VIEW [dbo].[vADUsers]
AS
    <em>[...SQL code from above]</em></code>
</pre>

<p>This mimics the adding of a Linked Server, but will be ignored by SQL Server on publish, because you already have a Linked Server with this name. The project is happy with it.</p>
<h3 id="Declare-the-data-structure"><a href="#Declare-the-data-structure" class="headerlink" title="Declare the data structure"></a>Declare the data structure</h3><p>When you use the SQL-View <code>vADUsers</code> in a Stored Procedure for example, this object won’t compile, because the project knows nothing about the fields of the ADSI data source. The SELECT in the view is not enough. You have to add an empty <code>SELECT</code> to the View <code>vADUsers</code>, just for the declaration of the fields and without returning any records and join this via <code>UNION</code> with the other statements:</p>
<pre>
<code>sp_addlinkedserver 'ADSI'
GO

CREATE VIEW [dbo].[vtADAllUsers]
AS

SELECT
    UserPrincipalName,
    DisplayName,
    sAMAccountName AS [SamAccountName],
    sn AS [LastName],
    givenName AS [FirstName],
    title AS [Title],
    Mail as [MailAddress],
    department AS [Department],
    l AS [Location],
    postalCode AS [PostCode],
    streetAddress AS [Street],
    st AS [State]
FROM (

    -- Fake SELECT to declare the structure of the view<strong>
    SELECT TOP 0
        '' UserPrincipalName,
        '' DisplayName,
        '' sAMAccountName,
        '' sn,
        '' givenName,
        '' department,
        '' title,
        '' Mail,
        '' l,
        '' postalCode,
        '' streetAddress,
        '' st

    UNION ALL</strong>

    SELECT *
    FROM OpenQuery(ADSI, '
        SELECT
            UserPrincipalName,
            DisplayName,
            sAMAccountName,
            sn,
            givenName,
            department,
            title,
            Mail,
            l,
            postalCode,
            streetAddress,
            st
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''
        WHERE objectClass =  ''User''
        AND objectCategory = ''Person''
        AND sn=''*''
        AND givenName = ''*''
        AND sAMAccountName &gt;= ''j''  
    ')

    UNION ALL  

    SELECT *  
    FROM OpenQuery(ADSI, '  
        SELECT <em>[...same as above]</em>  
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''  
        WHERE objectClass =  ''User''  
        AND objectCategory = ''Person''  
        AND sn=''*''  
        AND givenName = ''*''  
        AND sAMAccountName &lt; ''j''  
        AND sAMAccountName &gt; ''p''  
    ')

    UNION ALL  

    SELECT *  
    FROM OpenQuery(ADSI,  '  
        SELECT <em>[...same as above]</em>  
        FROM ''LDAP://mydomain.de/DC=mydomain,DC=de''  
        WHERE objectClass =  ''User''  
        AND objectCategory = ''Person''  
        AND sn=''*''  
        AND givenName = ''*''  
        AND sAMAccountName &lt;= ''p''  
    ')
) AD</code>
</pre>

<p>Now, you can fetch data from Active Directory and store the code in a Database Project properly.</p>
<p>HAPPY CODING :)</p>

    </div>
    
    <footer class="article-footer" data-pagefind-ignore>      
      
  <div class="article-tags">
    <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ADSI/" rel="tag">ADSI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database-Project/" rel="tag">Database Project</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Visual-Studio/" rel="tag">Visual Studio</a></li></ul>  
  </div>

      
      <div class="article-permalink" id="article-permalink-clowt48mq000gu3ou5123fha8">
    <input class="article-permalink-value" value="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/" 
           data-id="clowt48mq000gu3ou5123fha8" data-title="How-To: Visual Studio Database Project and ADSI" />
    <a class="article-action action-copy" title="Copy URL"></a>
    <a class="article-action action-share" title="Open Share Dialog"></a>
</div>
<script>
    window.addEventListener("load", () => {
        initPermalink("clowt48mq000gu3ou5123fha8");
    });
</script>

      
    </footer>

  </div>

  
  

<div class="article-share" data-pagefind-ignore>
  <button onclick="dialog.shareOnMastodon();" class="share mastodon">Share on Mastodon</button>
</div>

<div class="article-interaction" data-pagefind-ignore>
  <p>
    You can interact with this article (applause, criticism, whatever) 
    by mention it in one of your posts, which will also be shown here as a  
    <a href="https://en.wikipedia.org/wiki/Webmention"><em>Webmention</em></a> ... or you leave a good old comment with your GitHub account.   
  </p>
</div>

<div class="article-webmentions" data-pagefind-ignore>
  <h2>Webmentions</h2>

  <div class="webmentions-placeholder">
    <p class="wm-placeholder">No Webmentions yet...</p>
  </div>

  <p class="webmention-form-info">
    In case your blog software can't send Webmentions, 
    you can use this form to submit me a mention of this article...
  </p>

  <form class="webmention-form" action="https://webmention.io/kiko.io>/webmention" name="webmention-form"
    method="post">
    <label for="webmention-form-source">Your Article URL:</label><br>
    <input class="webmention-form-source" type="url" name="source" placeholder="https://your-blog.com/your-article"
      required="">
    <input type="hidden" name="target" value="https://kiko.io/post/How-To-Visual-Studio-Database-Project-and-ADSI/">
    <input type="submit" value="Send Webmention">
  </form>

  <script>
    window.addEventListener('load', function () {
      insertWebmentions('2019/How-To-Visual-Studio-Database-Project-and-ADSI', 'https://kiko.io', 'Kristof Zerbe');
    });
  </script>

  
  <input type="hidden" name="alias" value="https://kiko.io/categories/SQL/How-To-Visual-Studio-Database-Project-and-ADSI/">
  

</div>


<div class="article-comments" data-pagefind-ignore>
  <h2>Comments</h2>
  <div id="comment-placeholder"></div>
  <script>
    window.addEventListener('load', function () {
      insertUtterancesCommentBlock();
    });
  </script>
</div>

  
  
<nav id="article-nav">
  
    <a href="/post/A-New-Blog-VS-Code-Hexo-and-GitHub-Pages/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          A New Blog: VS Code, Hexo and GitHub Pages
        
      </div>
    </a>
  
  
</nav>

  

</article></main>
    
      <aside id="sidebar">
  
    <div class="widget-wrap">
    <div class="widget about h-card"><!--http://microformats.org/wiki/h-card-->
        <div class="avatar">
            <a href="/about"><img class="u-photo" src="/images/kristof-zerbe.png" alt="Kristof Zerbe"></a>
            <a href="https://github.com/kristofzerbe" target="_blank" class="fab fa-github" rel="me"></a>
            <a href="https://www.xing.com/profile/Kristof_Zerbe" target="_blank" class="fab fa-xing" rel="me"></a>
            <a href="https://www.linkedin.com/in/kristof-zerbe-91012510/" target="_blank" class="fab fa-linkedin" rel="me"></a>      
            <a href="https://500px.com/kikon" target="_blank" class="fab fa-500px" rel="me"></a>
            <a href="https://indieweb.social/@kiko" target="_blank" class="fab fa-mastodon" rel="me"></a>
            <a href="https://pixelfed.social/kristofz" target="_blank" class="fab fa-pixelfed" rel="me"></a>
        </div>
        <h3 class="p-name">Kristof Zerbe</h3>
        <p class="p-note">
            <i class="p-role">Developer & Team Lead</i><br>located in <i class="p-locality">Wiesbaden</i>,<br><i class="p-country-name">Germany</i>
        </p>
        <a class="u-url u-uid" href="https://kiko.io" style="display:none;"></a>
    </div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            
              <a href="/post/Experimenting-with-the-font-LEXEND/">Experimenting with the font LEXEND</a>
            
          </li>
        
          <li>
            
              <a href="/post/SVWW-vs-Hansa-Rostock-2023-10-29/">SVWW vs. Hansa Rostock @ 2023-10-29</a>
            
          </li>
        
          <li>
            
              <a href="/post/SGE-vs-HJK-2023-10-26/">SGE vs. HJK @ 2023-10-26</a>
            
          </li>
        
          <li>
            
              <a href="/post/Handling-IPTC-metadata-on-Android-and-Windows/">Handling IPTC metadata on Android and Windows</a>
            
          </li>
        
      </ul>
    </div>
  </div>

  

  <div class="widget widget-wrap">
    <p>
      Want more? This way ... to the <a href="/archives">archives</a>
    </p>
  </div>  
</aside>
    
  </div>
  <footer id="footer">
  
  <div class="outer">
    <div class="inner">

      <ul id="footer-dots">
        <li class="dot"><a href="https://search.google.com/search-console?resource_id=sc-domain%3Akiko.io" title="SearchConsole"></a></li>
        <li class="dot"><a href="https://kiko-io.pirsch.io/" title="Pirsch"></a></li>
        <li class="dot"><a href="https://webmentions.kiko.io" title="Webmention Analytics"></a></li>
      </ul>

      <div id="footer-info" class="footer-block">
        &copy; 2019-2023&nbsp;&nbsp;Kristof Zerbe
        <span class="dot-space">&#9679;</span>
        Powered by <a href="https://hexo.io/">Hexo</a> & <a href="https://github.com/">GitHub</a>
      </div>

      <div id="footer-links">
        
        <a href="/about">About</a>
        <span class="dot-space">&#9679;</span>
        
        <a href="/impressum">Impressum</a>
        <span class="dot-space">&#9679;</span>
        
        <a href="/feeds">Feeds</a>
        <span class="dot-space">&#9679;</span>
        
        <a href="javascript:dialog.pageMeta();">Page Meta</a>
      </div>

      <div id="footer-perf">
        Page loaded in <span class="perf-loadtime">0</span> at <span class="perf-viewport"></span>
        <script>
          window.addEventListener("resize", function () {
            const height = document.documentElement.clientHeight;
            const width = document.documentElement.clientWidth;
            document.querySelector("#footer-perf span.perf-viewport").innerHTML = `${width} x ${height}`;
          });
          window.addEventListener("load", function () {
            const pageEnd = performance.mark("pageEnd")
            const loadTime = pageEnd.startTime / 1000;
            document.querySelector("#footer-perf span.perf-loadtime").innerHTML = loadTime.toFixed(2);
            window.dispatchEvent(new Event('resize'));
          });
        </script>
      </div>

      <div id="webring">
        <a id="webring-prev" class="webring-link" href="https://xn--sr8hvo.ws/%F0%9F%A7%80%F0%9F%91%9F%F0%9F%8E%8A/previous">&nbsp;</a>
        <a href="https://xn--sr8hvo.ws">IndieWeb Webring&nbsp;🕸💍</a>
        <a id="webring-next" class="webring-link" href="https://xn--sr8hvo.ws/%F0%9F%A7%80%F0%9F%91%9F%F0%9F%8E%8A/next">&nbsp;</a>
      </div>

    </div>
  </div>
</footer>
  <script>
  let isOffline = 'false' === 'true';
</script>


<script src="/js/jquery-3.6.0.min.js"></script>


<script src="/js/dist/asset-bundle.min.js"></script>


<script src="/js/scripts.js"></script>


<script src="/js/dist/qr-code-styling.js"></script>


<script src="/js/dist/tinycolor-min.js"></script>


<script src="/js/dist/qr-code-styling-options-contact-light.json" id="qr-code-styling-options-light" type="application&#x2F;json"></script>


<script src="/js/dist/qr-code-styling-options-contact-dark.json" id="qr-code-styling-options-dark" type="application&#x2F;json"></script>


<script>
  //--- eval url hash on load
  var hash = window.location.hash.substr(1);
  switch (hash.toLowerCase()) {
    case "contact":
      window.addEventListener('load', function () {
        dialog.contact();
      });
      break;
    case "continue":
      //has no offset due to fixed header
      //...document.getElementById("more").scrollIntoView({ behavior: "smooth", block: "start", inline: "nearest"});
      window.scrollTo({
        behavior: 'smooth',
        top:
          document.querySelector("#more").getBoundingClientRect().top -
          document.body.getBoundingClientRect().top -
          200,
      });
      history.replaceState(null, null, ' '); // remove hash
    default: break;
  }
</script>

<script>

  //HEADER
  var header = {
    height: 0,
    top: 0,
    offset: 55,
    photoLinkOpacity: 0,
    titleFontSize: 0
  };
  function initHeader() {
    $("#header").css("height", ""); //reset inline css
    $("#header-title").css("top", "");
    $("#header-photo-link").css("opacity", "");
    $("#title-wrap").css("font-size", "");
    header.height = $("#header").height(); //set from given css
    header.top = parseFloat($("#header-title").css("top"));
    header.photoLinkOpacity = parseFloat($("#header-photo-link").css("opacity"));
    header.titleFontSize = parseFloat($("#title-wrap").css("font-size"));

    //change subtitle a bit
    let sub = $("#header").find("#subtitle");
    let col = sub.css("color");
    let rpl = `<span style="text-decoration:line-through;color:rgb(120 120 120)" title="not only anymore"><span style="color:${col};opacity:0.75">Tech</span></span>`;
    let txt = sub.text().trim().replace('Tech', rpl);
    sub.html(txt);

    scrollHeader();
  }
  function scrollHeader() {
    var h = header.height - header.offset,
        st = $(document).scrollTop(),
        d = (h - st),
        p = (d / h),
        hfs = header.titleFontSize / 5 * 3,
        jSide = $("aside");
    if (d > 0) {
      $("#header").css("height", d + header.offset + "px");
      $("#header-photo-link").css("opacity", header.photoLinkOpacity * p);
      $("#banner").css("opacity", p);
      $("#title-wrap").css("font-size", header.titleFontSize - ( header.titleFontSize / 3) * (1 - p) );
      $("#header-title").css("top", header.top - (hfs * (1 - p)) + "px");
      $("#subtitle").css("opacity", p);
      jSide.css("max-width", "").css("position", "").css("top", "");
    } else {
      $("#header").css("height", header.offset + "px");
      $("#header-photo-link").css("opacity", 0);
      $("#banner").css("opacity", 0);
      $("#title-wrap").css("font-size", header.titleFontSize - ( header.titleFontSize / 3) * (1) );
      $("#header-title").css("top", header.top - (hfs * (1)) + "px");
      $("#subtitle").css("opacity", 0);
      if (window.matchMedia("screen and (min-width: 768px)").matches & window.innerHeight > (jSide.height() + 50)) {
        jSide.css("max-width", $("aside").width()).css("position", "fixed").css("top", "50px");
      }
    }
  }

</script>

<script>
  /*** EVENTS */

  window.addEventListener('scroll', function() {
    scrollHeader();
    initViewportImage();
  }, { passive: true });

  window.addEventListener('resize', function() {
    initHeader();
    initViewportImage();
  });

  /*** INITS */
  // $(document).ready(function() {
    initHeader();
    initViewportImage();
    initNavMenuScroll();
    initScrollProgress();
  // });

  // BACK-TO-TOP
  addBackToTop({ diameter: 30 });

  // MENU-ITEM-SCROLL
  let pathItem = window.location.pathname.split('/')[1].toLowerCase();
  if (pathItem === "collections") pathItem = window.location.pathname.split('/')[2].toLowerCase()
  setTimeout(() => {
    let e = document.getElementById(`nav-${pathItem}-link`);
    if (e) e.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });
  }, 250);

  // AUTOTYPING
  setTimeout(function() {
    $("#title-wrap").empty();
    new AutoTyping({
      id: 'title-wrap',
      typeText: ['kiko.io'],
      textColor: '#fff',
      typeSpeed: 100,
      typeDelay: 100,
      showCursor: false,
      delete: false,
      typeInfinity: false
    }).init();
  }, 1000);

  //MEDIUM-ZOOM
  mediumZoom(document.querySelectorAll('img.zoom'), {
    background: 'rgba(55, 55, 55, 0.5)',
    margin: 20,
    scrollOffset: 10
  });

</script>


  <script>
    //HOOK LINKS FOR PIRSCH EVENT...

    //VSCODE
    let vscode = document.querySelectorAll(".brand-links .vscode").forEach(link => link.addEventListener("click", function() { pirsch("Open in VSCode"); }));

  </script>

</body>
<template id="contact-dialog">
  <div class="contact-content">
    <div class="contact-card">
      <div class="contact-face face-front">
        <div class="contact-face-wrapper">
          <img class="photo" src="/images/kristof-zerbe.png" alt="Kristof Zerbe">
          <div class="header">
            <h3>Kristof Zerbe</h3>
            <h4>Developer & Team Lead</h4>
            <p>Wiesbaden, Germany</p>
            <p class="download">
              <label>Save my contact by<br>downloading my</label>
              <a href="/kristof-zerbe.vcf" download="kristof-zerbe.vcf" class="fa-icon-download">vCard</a>  
            </p>
          </div>
          <hr class="divider">
          <div class="info">
            <p>
              <label>Mail me at</label>
              <a href="mailto:kristof.zerbe@gmail.com" class="fa-icon-mail">kristof.zerbe@gmail.com</a>    
            </p>
            <p>
              <label>Call me at</label>
              <a href="tel:+491716998867" class="fa-icon-phone">+49 171 6998867</a>  
            </p>
            <p>
              <label>Connect with me via</label>
              <a href="https://www.linkedin.com/in/kristof-zerbe-91012510/" class="fa-icon-linkedin">LinkedIn</a>
            </p>
            <p>
              <label>Connect with me via</label>
              <a href="https://www.xing.com/profile/Kristof_Zerbe" class="fa-icon-xing">Xing</a>
            </p>
            <p>
              <label>Follow me on</label>
              <a href="https://indieweb.social/@kiko" class="fa-icon-mastodon">Mastodon</a>  
            </p>
            <p>
              <label>Review my projects on</label>
              <a href="https://github.com/kristofzerbe" class="fa-icon-github">GitHub</a>  
            </p>
            <p>
              <label>Review my photos on</label>
              <a href="https://500px.com/kikon" class="fa-icon-500px">500px</a>  
            </p>
            <p>
              <label>Comment my photos on</label>
              <a href="https://pixelfed.social/kristofz" class="fa-icon-pixelfed">Pixelfed</a>  
            </p>
          </div>
        </div>
        <div class="contact-face-flip">flip for qrcode</div>
      </div>
      <div class="contact-face face-back">
        <div class="contact-face-wrapper">
          <div class="header">
            <h3>Kristof Zerbe</h3>
            <h4>kiko.io/#contact</h4>
          </div>
          <hr class="divider">
          <div id="contact-qrcode" class="qrcode"></div>
        </div>
        <div class="contact-face-flip">flip for card</div>
      </div>
    </div>
  </div>
</template>
<template id="mastodon-share-dialog">
  <div class="mastodon-share-content">
    <section>
      <p id="mastodon-share-intro">
        <img src="/images/mastodon.svg" alt="Mastodon">
        There are many Mastodon instances out there. 
        Tell me yours and I will redirect you to the share dialog of your server:
      </p>
      <label for="mastodon-instance">Your Mastodon Instance</label>
      <div id="mastodon-instance-wrapper">
        <span>https://</span>
        <input id="mastodon-instance" name="intance" required />
      </div>
      <label for="mastodon-text">Text to share ...</label>
      <textarea id="mastodon-text" name="text" rows="8"></textarea>
      <button id="mastodon-share">Share</button>
    </section>
  </div>
</template>
</html>