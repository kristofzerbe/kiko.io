<% if (post.bandcamp) { 
  
   let a = post.bandcamp.album.split("|");
   let album = { name: a[0], id: a[1] }

   let t = post.bandcamp.track.split("|");
   let track = { name: t[0], id: t[1] }
%>
  <details class="bandcamp">
    <summary>
      <em><%= post.bandcamp.artist %> - <%= track.name; %></em>
      <svg class="icon-music-note-accent">
        <use xlink:href="/images/icons/music-note-accent.svg#note"></use>
      </svg>
    </summary>
    <iframe id="bandcamp-player" src="" 
            width="100%" height="42px"
            load="lazy" seamless>
    </iframe>
  </details>
  <script>
    function setThemeBandcampPlayer() {
      let theme = document.documentElement.getAttribute("data-theme");
      let bgColor, lnkColor;

      if (theme === "dark") { bgColor = "333333"; lnkColor = "ffffff"; } 
      else { bgColor = "ffffff"; lnkColor = "333333";}

      let bcPlayerUri = `\
https://bandcamp.com/EmbeddedPlayer/\
album=<%= album.id %>/\
size=small/\
bgcol=${bgColor}/\
linkcol=${lnkColor}/\
track=<%= track.id %>/\
transparent=true/\
`;
      //leads to browser history change --- document.getElementById("bandcamp-player").src = bcPlayerUri;
      const orgFrame = document.getElementById("bandcamp-player");
      const newFrame = document.createElement("iframe");
      newFrame.setAttribute("id", "bandcamp-player");
      newFrame.setAttribute("width", "100%");
      newFrame.setAttribute("height", "42px");
      newFrame.setAttribute("load", "lazy");
      newFrame.setAttribute("src", bcPlayerUri);
      orgFrame.parentNode.replaceChild(newFrame, orgFrame);

    }
    setThemeBandcampPlayer();
    new MutationObserver(mutations => { setThemeBandcampPlayer(); })
      .observe(document.documentElement, {
        attributes: true, attributeFilter: ["data-theme"], attributeOldValue: true
      });
  </script>
<% } %>