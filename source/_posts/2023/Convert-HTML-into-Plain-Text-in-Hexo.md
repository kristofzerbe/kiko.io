---
slug: Convert-HTML-into-Plain-Text-in-Hexo
title: Convert HTML into Plain Text in Hexo
subtitle: Render Page.Excerpt into META Tag
date: 2023-08-31 21:58:36
photograph:
  file: D70_9227.jpg
  name: Tulips
  socialmedia: /static/images/social-media/Convert-HTML-into-Plain-Text-in-Hexo.png
series: A New Blog
categories:
  - JavaScript
tags:
  - Hexo
  - Meta
  - Node.js
related:
  - Show-pages-meta-data-JSON-LD-in-Bottom-Sheet
  - Include-and-provide-JSON-data-in-Hexo-EJS-Templates
  - Provide-Blog-Metadata-via-JSON-LD
syndication:
  - host: Mastodon
    url: https://indieweb.social/@kiko/110986400682618334
---

Hexo, on which this blog is based, is a Static Site Generator (SSG) that generates a whole structure of HTML files from individual Markdown files in which the articles were written. Besides the actual posts, also overview pages like the archives and others. For the latter, however, it only needs an excerpt from the actual article, which Hexo automatically creates from the initially generated HTML content and which is also available as HTML.

For my {% post_link Show-pages-meta-data-JSON-LD-in-Bottom-Sheet "Page Meta dialog" %}, however, I recently needed the excerpt as plain text to make it easier to transfer it manually to a Mastodon post, for example. My initial attempts to extract the plain text from the original Markdown turned out to be quite difficult, because in Hexo not only Markdown is used, but also special [Tag Plugins](https://hexo.io/docs/tag-plugins) in Nunjucks format and of course plain HTML. Long speech, short sense ... after the first dozen RegEx-Replace calls, I got doubts to be on the right way and remembered ``Page.Excerpt``, the variant already generated by Hexo in HTML.

<!-- more -->

Now you would think that JavaScript has some built-in function to extract the plain text out of a bunch of HTML tags, but this is actually not the case. You have to take a little detour to do this:

``` js
function convertHtml2PlainText(excerpt) {  
  let e = document.createElement("div");
  e.innerHTML = excerpt;
  return e.textContent || e.innerText;
}

let plainText = convertHtml2PlainText(page.excerpt);
```

Fine, my problem is solved ... hmm... NO, because Node.js does not know a ``document``, because a DOM exists only in the browser. But ... there are libraries like [**jsdom**](https://github.com/jsdom/jsdom) that make a DOM available in Node.js:

``` js
const { JSDOM } = require("jsdom");

function convertHtml2PlainText(excerpt) {
  const dom = new JSDOM('<!DOCTYPE html>');
  let e = dom.window.document.createElement("div");
  e.innerHTML = excerpt;
  return e.textContent || e.innerText;
}

let plainText = convertHtml2PlainText(page.excerpt);
```

Nice ... but also doesn't work, because I need the piece of code in an [**EJS**](https://ejs.co/) template, but when processing the same to HTML, the included JavaScript code is executed, but loading external libraries via ``require()`` is not supported.

And once again Hexo's [Tag Helpers](https://hexo.io/api/helper.html) come to my rescue:

```js helper-excerpt-plain.js
const { JSDOM } = require("jsdom");

hexo.extend.helper.register('excerpt_plain', function(excerpt){

  const dom = new JSDOM('<!DOCTYPE html>');
  let e = dom.window.document.createElement("div");
  e.innerHTML = excerpt;
  return e.textContent || e.innerText;

});
```

For the sake of beauty, I also cut out leading and double line breaks after the conversion and put the result in a custom meta tag in the head of the HTML page to have access to it later via JavaScript running in the browser: 

```js head.ejs
...

let excerpt = excerpt_plain(page.excerpt)
  .replace(/^(\r\n|\n|\r)/, "") // Remove leading break
  .replace(/(\r\n|\n|\r){2,}/g, " ") // Remove multiple breaks
  .trim();

...

<meta name="excerpt" content="<%= excerpt %>">

...
```

Et voil√° ... I have my excerpt as plain text to show in my Page Meta dialog.
